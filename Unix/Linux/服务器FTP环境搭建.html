<html>
<head>
  <title>服务器FTP环境搭建</title>
  <basefont face="Verdana" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604762 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: Verdana;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="589"/>
<h1>服务器FTP环境搭建</h1>

<div>
<span><div><span style="font-size: 14pt; font-family: 楷体;">操作系统：</span> <span style="font-size: 14pt; font-family: 楷体;">Ubuntu 18.04.4 LTS</span></div><div><span style="font-size: 14pt; font-family: 楷体;">服务器： 腾讯云服务器</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt; font-family: 楷体;">FTP（File Transfer Protocol）文件传</span><span style="font-size: 14pt; font-family: 楷体;">输协议。</span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14pt; font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">    基于客户端/服务器模式，默认使用20、21端口号，其</span><span style="font-size: 14pt; font-family: 楷体;">中端口20（数据端口）用于进行数据传输，端口21（命令端口）用于接受客户端发出的相关FTP命令与参数。FTP服务器普遍部署于局域网中，具有容易搭建、方便管理的特点。而且有些FTP客户端工具还可以支持文件的多点下载以及断点续传技术，因此FTP服务得到了广大用户的青睐。</span></div><div><font face="楷体" style="font-size: 14pt;"><br/></font></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">FTP协议有以下两种工作模式：</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">主动模式（PORT）：FTP服务器主动向客户端发起连接请求。</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">被动模式（PASV）：FTP服务器等待客户端发起连接请求（FTP的默认工作模式）。</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">vsftpd是一款运行在Linux操作系统上的FTP服务程序，具有很高的安全性和传输速度。</span></span></div><div><br/></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt; font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">关于主动模式和被动模式在上个文件中。</span></span></div><div><br/></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">vsftpd有以下三种认证模式：</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">匿名开放模式：是一种最不安全的认证模式，任何人都可以无需密码验证而直接登陆。</span></span></div><div><span style="font-size: 14pt; font-family: 楷体;">本地用户模式：是通过Linux系统本地的账户密码信息进行认证的模式，相较于匿名开放模式更安全，而且</span><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体;">配置起来简单。</span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 14pt; background-color: rgb(255, 255, 255); font-family: 楷体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 22.5px;">虚拟用户模式：是这三种模式中最安全的一种认证模式，它需要为FTP服务单独建立用户数据库文件，虚</span></span><span style="font-size: 14pt; font-family: 楷体;">拟出用来进行口令验证的</span></div><div><span style="font-size: 14pt; font-family: 楷体;">              账户信息，而这些账户信息在服务器系统中实际上</span><span style="font-size: 14pt;">是不存在的，仅供FTP服务程</span><span style="font-size: 14pt;">序进行认证使用。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt; font-family: 楷体;">Linux下的ftp的主要配置文件为/etc/vsftpd.conf，或者是/etc/vsftpd/vsftpd.conf。</span></div><div><span style="font-size: 14pt; font-family: 楷体;">在使用FTP前必须先安装FTP，ubuntu下安装：apt-get install vsftpd</span></div><div><span style="font-size: 14pt; font-family: 楷体;">以下是配置后的vsftpd.conf：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># Example config file /etc/vsftpd.conf</div><div># 客户端连接服务器后显示的欢迎信息</div><div>#ftpd_banner=Welcome to ftp service</div><div>#远程客户端响应端口数据连接超时时间, 单位为秒, 默认 60</div><div>#connect_timeout=&lt;n&gt;</div><div>#空闲的数据连接超时时间, 单位为秒, 默认 120</div><div>#accept_connection_timeout=&lt;n&gt;</div><div>#空闲的用户会话超时时间, 单位为秒, 默认 300</div><div>#data_connection_timeout=&lt;n&gt;</div><div>#在独立模式运行时, 最大连接数, 0 表示无限制</div><div>#max_clients=&lt;n&gt;</div><div>#独立模式运行时, 每 IP 的最大连接数, 0表示无限制</div><div>#max_per_ip=&lt;n&gt;</div><div>#是否允许虚拟用户登录</div><div>#guest_enable=YES</div><div>#限制远程的客户机连接后，所建立的控制连接，在多长时间没有做任何的操作就会中断(秒)</div><div>#idle_session_timeout=60</div><div><br/></div><div><br/></div><div>#设置ftp服务来监听的地址，客户端可以用哪个地址来连接</div><div>#listen_address=IP地址</div><div>#设置FTP工作的端口号，默认的为21</div><div>#listen_port=端口号</div><div><br/></div><div><br/></div><div>#设置切换到目录时显示.message隐含文件的内容</div><div>dirmessage_enable=YES</div><div>use_localtime=YES</div><div>#激活上传和下载日志</div><div>xferlog_enable=YES</div><div><br/></div><div><br/></div><div>#启用FTP数据端口连接</div><div>connect_from_port_20=YES</div><div><br/></div><div><br/></div><div>secure_chroot_dir=/var/run/vsftpd/empty</div><div>#设置PAM认证服务的配置文件名称, 该文件存放在/etc/pam.d目录下</div><div>pam_service_name=vsftpd</div><div><br/></div><div><br/></div><div>rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</div><div>rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</div><div>ssl_enable=NO</div><div><br/></div><div><br/></div><div>#YES: 服务以独立运行方式运行; NO: 运行在 xinetd 内。 默认为 YES</div><div>listen=YES</div><div>#是否允许本地用户登录</div><div>local_enable=YES</div><div>#是否允许本地用户上传</div><div>write_enable=YES</div><div>#本地用户上传的文件的生成掩码, 默认为077</div><div>#local_umask=077</div><div>#本地用户最大的传输速率, 单位为 Byte/s，值为0表示不限制</div><div>#local_max_rate=0</div><div><br/></div><div><br/></div><div><font color="#41AD1C">#是否允许匿名ftp,如否则选择NO</font></div><div><font color="#41AD1C">anonymous_enable=YES</font></div><div><font color="#41AD1C">#no_anon_password=YES</font></div><div><font color="#41AD1C">#匿名用户是否能上传</font></div><div><font color="#41AD1C">#anon_upload_enable=YES</font></div><div><font color="#41AD1C">#匿名用户是否能创建目录</font></div><div><font color="#41AD1C">#anon_mkdir_write_enable=YES</font></div><div><font color="#41AD1C">#修改文件名和删除文件</font></div><div><font color="#41AD1C">#anon_other_write_enable=YES</font></div><div><font color="#41AD1C">#匿名用户上传的文件的生成掩码, 默认为077</font></div><div><font color="#41AD1C">#anon_umask=022</font></div><div><font color="#41AD1C">#匿名用户的最大传输速率, 单位为 Byte/s, 值为 0 表示不限制</font></div><div><font color="#41AD1C">#anon_max_rate=0</font></div><div><font color="#41AD1C">#是否允许匿名用户只读浏览</font></div><div><font color="#41AD1C">anon_world_readable_only=YES</font></div><div><br/></div><div><br/></div><div><font color="#FF0000">#userlist_enable=YES</font></div><div><font color="#FF0000">#userlist_deny=NO</font></div><div><font color="#FF0000">#userlist_file=/etc/vsftpd.user_list</font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000">#userlist_enable和userlist_deny两个选项联合起来针对的是：本地全体用户（除去ftpusers中的用户）和出现在user_list文件中的用户以及不在在user_list</font></div><div><font color="#FF0000">#文件中的用户这三类用户集合进行的设置。</font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000">#当且仅当userlist_enable=YES时：userlist_deny项的配置才有效，user_list文件才会被使用；当其为NO时，无论userlist_deny项为何值都是无效的，本地全</font></div><div><font color="#FF0000">#体用户（除去ftpusers中的用户）都可以登入FTP</font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000">#当userlist_enable=YES时，userlist_deny=YES时：user_list是一个黑名单，即：所有出现在名单中的用户都会被拒绝登入；</font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000"><br/></font></div><div><font color="#FF0000">#当userlist_enable=YES时，userlist_deny=NO时：user_list是一个白名单，即：只有出现在名单中的用户才会被准许登入(user_list之外的用户都被拒绝登入</font></div><div><font color="#FF0000">#)；另外需要特别提醒的是：使用白名单后，匿名用户将无法登入！除非显式在user_list中加入一行：anonymous</font></div><div><br/></div><div><br/></div><div><font color="#2D4FC9">chroot_local_user=YES</font></div><div><font color="#2D4FC9">chroot_list_enable=YES</font></div><div><font color="#2D4FC9">chroot_list_file=/etc/vsftpd.chroot_list</font></div><div><font color="#2D4FC9">#chroot_local_user=YES 时，chroot_list_enable=YES时， 所有用户都可以ftp连接，限制在主目录下面。</font></div><div><font color="#2D4FC9">#启用chroot_list_file里面的用户名单，作为例外，不限制访问范围</font></div><div><font color="#2D4FC9"><br/></font></div><div><font color="#2D4FC9"><br/></font></div><div><font color="#2D4FC9">#chroot_local_user=NO 时，chroot_list_enable=YES 时，  所有用户都可以ftp连接，不限制范围。</font></div><div><font color="#2D4FC9">#启用chroot_list_file里面的用户名单，作为例外，限制访问范围在主目录</font></div><div><font color="#2D4FC9"><br/></font></div><div><font color="#2D4FC9"><br/></font></div><div><font color="#2D4FC9">#chroot_local_user=NO 时，chroot_list_enable=NO 时，   所有用户可以ftp连接，不限制范围。</font></div><div><font color="#2D4FC9">#不启用 chroot_list_file里面的用户名单，没有例外</font></div><div><font color="#2D4FC9"><br/></font></div><div><font color="#2D4FC9"><br/></font></div><div><font color="#2D4FC9">#chroot_local_user =YES 时，chroot_list_enable=NO 时，   所有用户可以ftp连接，限制在主目录下</font></div><div><font color="#2D4FC9">#不启用chroot_list_file里面的用户名单，没有例外</font></div><div><br/></div><div><br/></div><div>#本地用户登陆后的目录，默认为本地用户的主目录</div><div>#local_root=/srv/ftp/</div><div><br/></div><div>allow_writeable_chroot=YES</div><div><br/></div><div>#匿名用户设置，不设置会默认匿名用户为ftp，设置为nobody为不使用匿名用户，好像只能使用ftp作为匿名用户和nobody不使用匿名用户，优先级高于anonymous_enable</div><div>#ftp_username=nobody</div><div><br/></div><div>#开启被动模式</div><div>pasv_enable=YES</div><div># PASV模式最小端口</div><div>pasv_min_port=40000</div><div># PASV模式最大端口</div><div>pasv_max_port=45000</div></div><div><br/></div><div><span style="font-size: 14pt; font-family: 楷体;">黑名单文件：/etc/ftpusers，里面的用户禁止使用ftp服务，其中每个用户占一行，系统为了防止权限过高的用户登录ftp服务器，随意篡改数据，将很多高权限用户列入了黑名单，如root用户。</span></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt; font-family: 楷体;">以上配置文件中还出现两个文件vsftpd.user_list和</span><span style="font-size: 14pt; font-family: 楷体;">vsftpd.chroot_list,这两个文件是自己创建的，当对应配置启用时文件才会生效，文件作用如配置文件中所述。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt; font-family: 楷体;">配置文件生效：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@VM-0-7-ubuntu:~# systemctl restart vsftpd</div></div><div><span style="font-size: 14pt; font-family: 楷体;">配置文件日志信息可在/var/log/vsftpd.log和/var/log/syslog下查看，如开启ftp服务出错可根据日志排查。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt; font-family: 楷体;">配置FTP需要关闭和防火墙和SELinux：</span> <span style="font-size: 14pt;"><a href="https://blog.csdn.net/amaoatao/article/details/81000314" style="font-size: 14pt; font-family: 楷体;">https://blog.csdn.net/amaoatao/article/details/81000314</a></span></div><div><br/></div><div><br/></div><div><span style="font-size: 14pt; font-family: 楷体;">服务器配置：</span></div><div><span style="font-size: 14pt; font-family: 楷体;">服务器端需要放通40000-45000的端口（通过配置文件设置），以及FTP命令和数据端口20，21。</span></div><div><span style="font-size: 14pt; font-family: 楷体;">在服务器安全组中配置：</span></div><div style="text-align: center;"><span style="font-size: 14pt; font-family: 楷体;"><img src="服务器FTP环境搭建_files/Image.png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt; font-family: 楷体;">最后重启FTP服务。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><font style="font-size: 18pt;"><span style="font-size: 18pt; font-family: 楷体; font-weight: bold;">匿名访问</span></font></div><div><span style="font-size: 14pt; font-family: 楷体;">在上述配置文件中，采用的是匿名访问方式，用户登录可以不需要进行用户名密码验证，如果在命令行界面操作需要验证，默认用户名为ftp，密码直接回车，在Linux的用户配置信息/etc/passwd中，可以看到当匿名访问FTP时，访问的FTP目录为/srv/ftp。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ftp:x:112:116:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin</div></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">匿名登录下只能访问/srv/ftp目录，如果需要更改ftp用户目录，可以强制修改/etc/passwd中的对应用户，也可以使用usermod命令进行更改，再重启FTP服务。</span></div><div><br/></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">测试匿名状态下的windows登录，Linux登录和浏览器登录：</span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">首先/srv/ftp下的文件结构：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(51, 51, 51);">ubuntu@VM-0-7-ubuntu:~$ tree /srv/ftp</span></div><div><span style="color: rgb(51, 51, 51);">/srv/ftp</span></div><div><span style="color: rgb(51, 51, 51);">└── pub</span></div><div><span style="color: rgb(51, 51, 51);">    ├── haha</span></div><div><span style="color: rgb(51, 51, 51);">    ├── tcp_client</span></div><div><span style="color: rgb(51, 51, 51);">    ├── tcp_client.c</span></div><div><span style="color: rgb(51, 51, 51);">    ├── tcp_server</span></div><div><span style="color: rgb(51, 51, 51);">    └── tcp_server.c</span></div><div><span style="color: rgb(51, 51, 51);">1 directory, 5 files</span></div></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">使用Windows登录：</span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">打开我的电脑：输入ftp://服务器IP</span></div><div style="text-align: center;"><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;"><img src="服务器FTP环境搭建_files/Image [1].png" type="image/png" data-filename="Image.png" width="762"/></span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">登录成功后：</span></div><div style="text-align: center;"><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;"><img src="服务器FTP环境搭建_files/Image [2].png" type="image/png" data-filename="Image.png" width="764"/></span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">使用浏览器登录：</span></div><div style="text-align: center;"><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;"><img src="服务器FTP环境搭建_files/Image [3].png" type="image/png" data-filename="Image.png" width="763"/></span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">使用Linux命令行登录：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ubuntu@VM-0-7-ubuntu:~$ ftp 122.51.39.242</div><div>Connected to 122.51.39.242.</div><div>220 (vsFTPd 3.0.3)</div><div><font color="#FF0000">Name (122.51.39.242:ubuntu): ftp</font></div><div>331 Please specify the password.</div><div><font color="#FF0000">Password:回车</font></div><div>230 Login successful.</div><div>Remote system type is UNIX.</div><div>Using binary mode to transfer files.</div><div><font color="#FF0000">ftp&gt; passive//开启被动模式</font></div><div>Passive mode on.</div><div><font color="#FF0000">ftp&gt; ls</font></div><div>227 Entering Passive Mode (122,51,39,242,159,92).</div><div>150 Here comes the directory listing.</div><div><font color="#2D4FC9">drwxr-xr-x    2 0        0            4096 May 28 14:39 pub</font></div><div>226 Directory send OK.</div><div><font color="#FF0000">ftp&gt; cd pub</font></div><div>250 Directory successfully changed.</div><div><font color="#FF0000">ftp&gt; ls</font></div><div>227 Entering Passive Mode (122,51,39,242,166,207).</div><div>150 Here comes the directory listing.</div><div><font color="#2D4FC9">-rw-r--r--    1 0        0               0 May 28 02:21 haha</font></div><div><font color="#2D4FC9">-rwxr-xr-x    1 0        0           13032 May 28 14:39 tcp_client</font></div><div><font color="#2D4FC9">-rw-r--r--    1 0        0            2117 May 28 14:39 tcp_client.c</font></div><div><font color="#2D4FC9">-rwxr-xr-x    1 0        0           13208 May 28 14:39 tcp_server</font></div><div><font color="#2D4FC9">-rw-r--r--    1 0        0            3463 May 28 14:39 tcp_server.c</font></div><div>226 Directory send OK.</div><div>ftp&gt;</div></div><div><span style="font-size: 14pt;"><br/></span></div><div><font style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(51, 51, 51); font-family: 楷体; font-weight: bold;">用户访问</span></font></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">修改配置文件，</span><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">开启红色部分。默认vsftpd.user_list中的用户才能登录，由于匿名用户仍然开启，需要将匿名用户ftp加入到vsftpd.user_list中，才能正常匿名访问。</span></div><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: 楷体;">创建新用户和其目录：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@VM-0-7-ubuntu:~# useradd -d /srv/ftp/ zhanghang</div><div>root@VM-0-7-ubuntu:~# passwd zhanghang</div><div>Enter new UNIX password:</div><div>Retype new UNIX password:</div><div>passwd: password updated successfully</div></div><div>查看/etc/passwd可以看到新用户属性</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>zhanghang:x:1001:1001::/srv/ftp/:/bin/sh</div></div><div><span style="font-size: 14pt;">此用户关联目录为/srv/ftp。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;">登录测试：</span></div><div><span style="font-size: 14pt; font-family: 楷体;">在Windows下可能提示无权访问，暂未解决。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt; font-family: 楷体;">浏览器测试：</span></div><div style="text-align: center;"></div><div style="text-align: center;"><img src="服务器FTP环境搭建_files/Image [4].png" type="image/png" data-filename="Image.png" width="643"/></div><div>Linux下测试：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@VM-0-7-ubuntu:~# ftp 122.51.39.242</div><div>Connected to 122.51.39.242.</div><div>220 (vsFTPd 3.0.3)</div><div><font color="#FF0000">Name (122.51.39.242:ubuntu): zhanghang</font></div><div>331 Please specify the password.</div><div>Password:</div><div>230 Login successful.</div><div>Remote system type is UNIX.</div><div>Using binary mode to transfer files.</div><div>ftp&gt; passive</div><div>Passive mode on.</div><div>ftp&gt; ls</div><div>227 Entering Passive Mode (122,51,39,242,159,253).</div><div>150 Here comes the directory listing.</div><div>drwxr-xr-x    2 0        0            4096 May 28 14:39 pub</div><div>226 Directory send OK.</div><div>ftp&gt; cd pub</div><div>250 Directory successfully changed.</div><div>ftp&gt; ls</div><div>227 Entering Passive Mode (122,51,39,242,174,17).</div><div>150 Here comes the directory listing.</div><div>-rw-r--r--    1 0        0               0 May 28 02:21 haha</div><div>-rwxr-xr-x    1 0        0           13032 May 28 14:39 tcp_client</div><div>-rw-r--r--    1 0        0            2117 May 28 14:39 tcp_client.c</div><div>-rwxr-xr-x    1 0        0           13208 May 28 14:39 tcp_server</div><div>-rw-r--r--    1 0        0            3463 May 28 14:39 tcp_server.c</div><div>226 Directory send OK.</div><div>ftp&gt;</div></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;">其他说明：</span></div><div><span style="font-size: 14pt;">配置文件中的local_root变量，如果用户在user_list名单中，但是没有设置用户目录，用户将会登录到local_root指定路径中。</span></div><div><span style="font-size: 14pt;"><br/></span></div><div>chroot系列变量，使用user_list中的用户登录到ftp时，可以访问到整个linux服务器的所有数据，为了防止用户篡改或盗用除ftp服务器外的数据，可以使用chroot系列变量进行设置，使用户只能限制在自己的主目录中。</div><div><br/></div><div><span style="font-size: 14pt;">部分FTP操作命令使用</span></div><div>登录ftp:  ftp+ip地址</div><div>其他命令使用：</div><div>首先开启被动模式</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ftp&gt; passive</div></div><div>？展示所有ftp命令</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ftp&gt; ?</div><div>Commands may be abbreviated.  Commands are:</div><div><br/></div><div><br/></div><div>!               dir             mdelete         qc              site</div><div>$               disconnect      mdir            sendport        size</div><div>account         exit            mget            put             status</div><div>append          form            mkdir           pwd             struct</div><div>ascii           get             mls             quit            system</div><div>bell            glob            mode            quote           sunique</div><div>binary          hash            modtime         recv            tenex</div><div>bye             help            mput            reget           tick</div><div>case            idle            newer           rstatus         trace</div><div>cd              image           nmap            rhelp           type</div><div>cdup            ipany           nlist           rename          user</div><div>chmod           ipv4            ntrans          reset           umask</div><div>close           ipv6            open            restart         verbose</div><div>cr              lcd             prompt          rmdir           ?</div><div>delete          ls              passive         runique</div><div>debug           macdef          proxy           send</div></div><div><span style="font-size: 14pt;">用法我也不知道，百度吧。</span></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="font-size: 14pt;">上传（put)和下载(get)测试：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>ubuntu@VM-0-7-ubuntu:~$ ls</div><div>socket</div><div>ubuntu@VM-0-7-ubuntu:~$ <font color="#E30000">touch xixi</font></div><div>ubuntu@VM-0-7-ubuntu:~$ ls</div><div>socket  <font color="#FF0000">xixi</font></div><div>ubuntu@VM-0-7-ubuntu:~$ ftp 122.51.39.242</div><div>Connected to 122.51.39.242.</div><div>220 (vsFTPd 3.0.3)</div><div>Name (122.51.39.242:ubuntu): zhanghang</div><div>331 Please specify the password.</div><div>Password:</div><div>230 Login successful.</div><div>Remote system type is UNIX.</div><div>Using binary mode to transfer files.</div><div>ftp&gt; <font color="#FF0000">passive</font></div><div>Passive mode on.</div><div>ftp&gt; ls</div><div>227 Entering Passive Mode (122,51,39,242,166,4).</div><div>150 Here comes the directory listing.</div><div>drwxrwxrwx    2 0        0            4096 May 28 14:39 pub</div><div>226 Directory send OK.</div><div>ftp&gt; <font color="#FF0000">put xixi</font></div><div>local: xixi remote: xixi</div><div>227 Entering Passive Mode (122,51,39,242,168,212).</div><div>150 Ok to send data.</div><div>226 Transfer complete.</div><div>ftp&gt; ls</div><div>227 Entering Passive Mode (122,51,39,242,168,203).</div><div>150 Here comes the directory listing.</div><div>drwxrwxrwx    2 0        0            4096 May 28 14:39 pub</div><div><font color="#FF0000">-rw-------    1 1001     1001            0 May 28 20:36 xixi</font></div><div>226 Directory send OK.</div><div>ftp&gt; cd pub</div><div>250 Directory successfully changed.</div><div>ftp&gt; ls</div><div>227 Entering Passive Mode (122,51,39,242,166,249).</div><div>150 Here comes the directory listing.</div><div>-rwxrwxrwx    1 0        0               0 May 28 02:21 haha</div><div>-rwxrwxrwx    1 0        0           13032 May 28 14:39 tcp_client</div><div>-rwxrwxrwx    1 0        0            2117 May 28 14:39 tcp_client.c</div><div>-rwxrwxrwx    1 0        0           13208 May 28 14:39 tcp_server</div><div>-rwxrwxrwx    1 0        0            3463 May 28 14:39 tcp_server.c</div><div>226 Directory send OK.</div><div>ftp&gt; <font color="#FF0000">get haha</font></div><div>local: haha remote: haha</div><div>227 Entering Passive Mode (122,51,39,242,164,170).</div><div>150 Opening BINARY mode data connection for haha (0 bytes).</div><div>226 Transfer complete.</div><div>ftp&gt; ^Z</div><div>[3]+  Stopped                 ftp 122.51.39.242</div><div>ubuntu@VM-0-7-ubuntu:~$ ls</div><div><font color="#FF0000">haha</font>  socket  xixi</div></div><div><font style="font-size: 14pt;"><br/></font></div><div>上面的put可以执行的首要条件是/srv/ftp是可写的，get执行的首要条件是/srv/ftp是可读的，所以必须对/srv/ftp开启o的w权限。次要条件是vsftpd.conf中的读写变量的设定。</div><div><br/></div><div>在/srv/ftp具备w权限情况下，匿名登录会登不上，提示不允许有写的权限，所以/srv/ftp要减去o和g的w权限，但是没有w权限的匿名用户是无法上传文件的。所以这里就遇到一个问题：用户要上传文件/srv/ftp必须具备w权限，匿名登录/srv/ftp不能具备w权限，匿名上传文件/srv/ftp必须具备w权限，三个矛盾点。问题的解决方式就是设置/srv/ftp不具备w权限，这样用户和匿名都可以登录，再在/srv/ftp下创建anonymous和pub目录，修改使两个目录都具备w权限，这个登录ftp后，用户和匿名用户可以直接进入对应的目录进行上传操作（当前目录可w）。而且一般情况下，/srv/ftp为匿名用户ftp的默认登录目录，默认权限是755，此目录一般不给用户使用。用户目录一般在别的地方创建。</div><div><br/></div><div>此外匿名用户的上传除了受到目录权限影响，也受配置文件影响，同用户上传。</div><div><br/></div><div>如果直接创建用户useradd user1，passwd user1，系统会记录用户的主目录为/home/user1,而此目录是不存在的，因此使用此用户ftp登录时，会报错，直接使用usermod为此用户关联一个目录即可。</div><div><br/></div><div>配置文件中的local_user变量指定用户登录后的默认ftp目录。此项如果开启，所有用户登录后的ftp主目录都会被设定为它。如果不设定，就会访问用户自己的主目录。</div><div><br/></div><div>最后是一个默认vsftpd.conf文件，无任何修改</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># Example config file /etc/vsftpd.conf</div><div>#</div><div># The default compiled in settings are fairly paranoid. This sample file</div><div># loosens things up a bit, to make the ftp daemon more usable.</div><div># Please see vsftpd.conf.5 for all compiled in defaults.</div><div>#</div><div># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</div><div># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd's</div><div># capabilities.</div><div>#</div><div>#</div><div># Run standalone?  vsftpd can run either from an inetd or as a standalone</div><div># daemon started from an initscript.</div><div>listen=NO</div><div>#</div><div># This directive enables listening on IPv6 sockets. By default, listening</div><div># on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6</div><div># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</div><div># sockets. If you want that (perhaps because you want to listen on specific</div><div># addresses) then you must run two copies of vsftpd with two configuration</div><div># files.</div><div>listen_ipv6=YES</div><div>#</div><div># Allow anonymous FTP? (Disabled by default).</div><div>anonymous_enable=NO</div><div>#</div><div># Uncomment this to allow local users to log in.</div><div>local_enable=YES</div><div>#</div><div># Uncomment this to enable any form of FTP write command.</div><div>#write_enable=YES</div><div>#</div><div># Default umask for local users is 077. You may wish to change this to 022,</div><div># if your users expect that (022 is used by most other ftpd's)</div><div>#local_umask=022</div><div>#</div><div># Uncomment this to allow the anonymous FTP user to upload files. This only</div><div># has an effect if the above global write enable is activated. Also, you will</div><div># obviously need to create a directory writable by the FTP user.</div><div>#anon_upload_enable=YES</div><div>#</div><div># Uncomment this if you want the anonymous FTP user to be able to create</div><div># new directories.</div><div>#anon_mkdir_write_enable=YES</div><div>#</div><div># Activate directory messages - messages given to remote users when they</div><div># go into a certain directory.</div><div>dirmessage_enable=YES</div><div>#</div><div># If enabled, vsftpd will display directory listings with the time</div><div># in  your  local  time  zone.  The default is to display GMT. The</div><div># times returned by the MDTM FTP command are also affected by this</div><div># option.</div><div>use_localtime=YES</div><div>#</div><div># Activate logging of uploads/downloads.</div><div>xferlog_enable=YES</div><div>#</div><div># Make sure PORT transfer connections originate from port 20 (ftp-data).</div><div>connect_from_port_20=YES</div><div>#</div><div># If you want, you can arrange for uploaded anonymous files to be owned by</div><div># a different user. Note! Using &quot;root&quot; for uploaded files is not</div><div># recommended!</div><div>#chown_uploads=YES</div><div>#chown_username=whoever</div><div>#</div><div># You may override where the log file goes if you like. The default is shown</div><div># below.</div><div>#xferlog_file=/var/log/vsftpd.log</div><div>#</div><div># If you want, you can have your log file in standard ftpd xferlog format.</div><div># Note that the default log file location is /var/log/xferlog in this case.</div><div>#xferlog_std_format=YES</div><div>#</div><div># You may change the default value for timing out an idle session.</div><div>#idle_session_timeout=600</div><div>#</div><div># You may change the default value for timing out a data connection.</div><div>#data_connection_timeout=120</div><div>#</div><div># It is recommended that you define on your system a unique user which the</div><div># ftp server can use as a totally isolated and unprivileged user.</div><div>#nopriv_user=ftpsecure</div><div>#</div><div># Enable this and the server will recognise asynchronous ABOR requests. Not</div><div># recommended for security (the code is non-trivial). Not enabling it,</div><div># however, may confuse older FTP clients.</div><div>#async_abor_enable=YES</div><div>#</div><div># By default the server will pretend to allow ASCII mode but in fact ignore</div><div># the request. Turn on the below options to have the server actually do ASCII</div><div># mangling on files when in ASCII mode.</div><div># Beware that on some FTP servers, ASCII support allows a denial of service</div><div># attack (DoS) via the command &quot;SIZE /big/file&quot; in ASCII mode. vsftpd</div><div># predicted this attack and has always been safe, reporting the size of the</div><div># raw file.</div><div># ASCII mangling is a horrible feature of the protocol.</div><div>#ascii_upload_enable=YES</div><div>#ascii_download_enable=YES</div><div>#</div><div># You may fully customise the login banner string:</div><div>#ftpd_banner=Welcome to blah FTP service.</div><div>#</div><div># You may specify a file of disallowed anonymous e-mail addresses. Apparently</div><div># useful for combatting certain DoS attacks.</div><div>#deny_email_enable=YES</div><div># (default follows)</div><div>#banned_email_file=/etc/vsftpd.banned_emails</div><div>#</div><div># You may restrict local users to their home directories.  See the FAQ for</div><div># the possible risks in this before using chroot_local_user or</div><div># chroot_list_enable below.</div><div>#chroot_local_user=YES</div><div>#</div><div># You may specify an explicit list of local users to chroot() to their home</div><div># directory. If chroot_local_user is YES, then this list becomes a list of</div><div># users to NOT chroot().</div><div># (Warning! chroot'ing can be very dangerous. If using chroot, make sure that</div><div># the user does not have write access to the top level directory within the</div><div># chroot)</div><div>#chroot_local_user=YES</div><div>#chroot_list_enable=YES</div><div># (default follows)</div><div>#chroot_list_file=/etc/vsftpd.chroot_list</div><div>#</div><div># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</div><div># default to avoid remote users being able to cause excessive I/O on large</div><div># sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</div><div># the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</div><div>#ls_recurse_enable=YES</div><div>#</div><div># Customization</div><div>#</div><div># Some of vsftpd's settings don't fit the filesystem layout by</div><div># default.</div><div>#</div><div># This option should be the name of a directory which is empty.  Also, the</div><div># directory should not be writable by the ftp user. This directory is used</div><div># as a secure chroot() jail at times vsftpd does not require filesystem</div><div># access.</div><div>secure_chroot_dir=/var/run/vsftpd/empty</div><div>#</div><div># This string is the name of the PAM service vsftpd will use.</div><div>pam_service_name=vsftpd</div><div>#</div><div># This option specifies the location of the RSA certificate to use for SSL</div><div># encrypted connections.</div><div>rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</div><div>rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</div><div>ssl_enable=NO</div><div><br/></div><div><br/></div><div># Uncomment this to indicate that vsftpd use a utf8 filesystem.</div><div>#utf8_filesystem=YES</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 14pt;"><br/></font></div></span>
</div></body></html> 