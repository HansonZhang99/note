# 输出重定向
嵌入式设备打印的标准输出一般默认是串口，如果通过SSH登陆设备，无法获取设备的打印，可以通过将定向至串口的打印重定向到SSH打开的终端。
关键函数：
dup，dup2，ttyname
```c
//p6.1.c 获得标准输入、输出和错误输出的终端名称
#include <stdio.h>
#include <unistd.h>

int main(int argc,char* argv[]){
//下面3个字符指针分别用来保存标准输入、标准输出和
//标准错误输出的终端名
char* tty_out_name;
char* tty_in_name;
char* tty_err_name;

//调用ttyname函数来获得终端名称，如果返回结果为NULL，表示
//调用失败，输出错误信息
if((tty_out_name=ttyname(STDOUT_FILENO))==NULL){
perror("Cannot get tty name");
return 1;
}

//打印输出获得的终端名称
printf("STDOUT_FILENO tty name is :%s\n",tty_out_name);

if((tty_in_name=ttyname(STDIN_FILENO))==NULL){
perror("Cannot get tty name");
return 1;
}

printf("STDIN_FILENO tty name is :%s\n",tty_in_name);

if((tty_err_name=ttyname(STDERR_FILENO))==NULL){
perror("Cannot get tty name");
return 1;
}

printf("STDERR_FILENO tty name is :%s\n",tty_err_name);
return 0;
}
```
```c
int g_original_stdout = -1;
int r_stdout = -1;
char *ttyname(int fd); //标准库函数，根据fd获取对应设备，通常fd为STDIN_FILENO,STDOUT_FILENO,STDERR_FILENO
int redirection_stdout(const char *device_name)
{
    int dup2_retval = -1;
    if(NULL == device_name)
        return -1;
    if(r_stdout >= 0)
        return -2;//has already redirected;
    r_stdout = open(device_name, O_WRONLY|O_NONBLOCK)
    if(r_stdout < 0)
        return -2;
    g_original_stdout = dup(STDOUT_FILENO);//save original stdout;
    dup2_retval = dup2(r_stdout, STDOUT_FILENO);
    if(g_original < 0 || dup2_retval < 0)
    {
        printf("dup error or dup2 error\n");
        close(r_stdout);
        r_stdout = -1;
        return -4;
    }
    return 0;
}

int recover_stdout(void)
{
    if(r_stdout < 0)
        return -1;//has already recover;
    if(dup2(g_original_stdout, STDOUT_FILENO) < 0)
    {
        printf("dup2 error\n");
        return -2;
    }
    close(r_stdout);
    close(g_original_stdout);
    r_stdout = g_original_stdout = -1;
    return 0;
}
```
设备主进程运行默认输出日志到串口，即主进程main函数的STDOUT_FILENO所关联的默认为串口
希望将输出定向到SSH打开的终端，需要main函数获取到打开的SSH对应的/dev下的终端文件，在main中打开此文件后，将main中的STDOUT_FILEOUT定向到此文件即可