<html>
<head>
  <title>6.连接监听器：接受TCP连接</title>
  <basefont face="Verdana" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604762 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: Verdana;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="937"/>
<h1>6.连接监听器：接受TCP连接</h1>

<div>
<span><div><font style="font-size: 11pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">机制提供了一种监听并接受到来的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">TCP</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">连接的方法</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">所有的函数和类型这里都定义在</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">event2/listener.h</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">中</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">除非特别说明。</span></font></div><div><br/></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">创建或释放一个evconnlistener</span></span></font></div><div><br/></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">struct evconnlistener* evconnlistener_new(struct event_base * base,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            evconnlistener_cb cb,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            void* ptr,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            unsigned flags,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            int backlog,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            evutil_socket_t fd);</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">struct evconnlistener* evconnlistener_new_bind(struct event_base * base,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            evconnlistener_cb cb,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            void* ptr,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            unsigned flags,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            int backlog,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            const struct sockaddr* sa,</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            int socklen);</span></font></div><div><font><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">void evconnlistener_free(struct evconnlistener* lev);</span></font></div></div><div style="font-size: 10pt;"></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">两个</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;"> </span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">evconnlistener_new*()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">函数都分配和返回一个新的连接监听器对象</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: Calibri;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">连接监听器使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: Calibri;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">来得知什么时候在给定的监听套接字上有新的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: Calibri;">TCP</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">连接</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: Calibri;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">新连接到达时</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: Calibri;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: 宋体;">监听器调用你给出的回调函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; font-size: 11pt; font-family: Calibri;">.</span></font></span></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;"><br/></font></div><div><span style="font-size: 11pt;">两个函数中,base参数都是监听器用于监听连接的event_base.</span></div><div><span style="font-size: 11pt;">cb是收到新连接时要调用的回调函数;如果cb为NULL,则监听器是禁用的,直到设置了回调函数为止.</span></div><div><span style="font-size: 11pt;">ptr指针将传递给回调函数.</span></div><div><span style="font-size: 11pt;">flags参数控制回调函数的行为,下面会更详细论述.</span></div><div><span style="font-size: 11pt;">backlog是任何时刻网络栈允许处于还未接受状态的最大未决连接数.更多细节请查看系统的listen()函数文档.如果backlog是负的,libevent会试图挑选一个较好的值;如果为0,libevent认为已经对提供的套接字调用了 listen().</span></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;"><br/></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0px 0px 16px; padding: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">两个函数的不同在于如何建立监听套接字</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">.evconnlistener_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">函数假定已经将套接字绑</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">定到要监听的端口</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">,</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">然后通过</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">fd</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">传入这个套接字</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">.</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">如果要</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">libevent</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">分配和绑定套接字</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">,</span><span style="outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">可</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">以调用</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">evconnlistener_new_bind(),</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">传输要绑定到的地址和地址长度</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; font-size: 11pt;">.</span></font></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">注意:</span></font></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">当使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener_new</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">的时候务必确认你的监听</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">socket</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">是非阻塞模式</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">evutil_make_socket_nonblocking</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">或手动设置</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">socket</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">的正确选项</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">当监听</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">socket</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">处于阻塞模式</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">将会导致一些无法预知的行为发生</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">要释放连接监听器</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">应调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener_free().</span></font></div><div><font style="font-size: 11pt;"><br/></font></div><div><font style="font-size: 11pt;"><br/></font></div><div><span style="font-size: 11pt;">可识别的标志：</span></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以给</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">flags</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">参数传入一些标志</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以用或</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">(OR)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">运算任意连接下述标志</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><div><br/></div><ul><li><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">LEV_OPT_LEAVE_SOCKETS_BLOCKING</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">默认情况下</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">连接监听器接收新套接字后</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">会将其设置为非阻塞的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">以便将其用于</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">libevent .</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果不想要这种行为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以设置这个标志</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div></li><li><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">LEV_OPT_CLOSE_ON_FREE</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果设置了这个选项</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">释放连接监听器会关闭底层套接字</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div></li><li><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">LEV_OPT_CLOSE_ON_EXEC</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果设置了这个选项</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">连接监听器会为底层套接字设置</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">close-on-exec</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">标志</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">更多信息请查看</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">fcntl</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">和</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">FD_CLOEXEC</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的平台文档</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div></li><li><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">LEV_OPT_REUSEABLE:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">某些平台在默认情况下</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">关闭某监听套接字后</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要过一会儿其他套接字才可以绑定到同一个端口</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设置这个标志会让</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">libevent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">标记套接字是可重用的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这样一旦关闭</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以立即打开其他套接字</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在相同端口进行监听</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div></li><li><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">LEV_OPT_THREADSAFE</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">为监听器分配锁</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这样就可以在多个线程中安全地使用了</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这是</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">2.0.8-rc</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的新功能</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 10.5pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div></li></ul><div style="font-size: 10pt;"><br/></div><div><span style="font-weight: bold; font-size: 11pt;">连接监听器回调</span></div><div style="font-size: 10pt;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>typedef void ( * evconnlistener_cb)(struct evconnlistener* listener,</div><div>            evutil_socket_t sock,</div><div>            struct sockaddr* addr,</div><div>            int len,</div><div>            void * ptr);</div></div><div style="font-size: 10pt;"><br/></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">当一个新的连接到来</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">提供的回调函数将会被调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">listener</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">是用于接受连接的连接监听器</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">产生</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">sock</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">是新的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">socket.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">addr</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">和</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">len</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">分别是接受的连接地址和地址的长度</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">ptr</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">是传到</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">的用户提供的指针</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><font style="font-size: 11pt;"><br/></font></div><div><span style="font-weight: bold; font-size: 11pt;">启用和禁用evconnlistener</span></div><div style="font-size: 10pt;"><br/></div><div style="font-size: 10pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int evconnlistener_disable(struct evconnlistener* lev);</div><div>int evconnlistener_enable(struct evconnlistener* lev);</div></div></div><div style="font-size: 10pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这两个函数临时启用或禁用监听新的连接的功能</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">调整evconnlistener的回调函数</span></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>void evconnlistener_set_cb(struct evconnlistener* lev,</div><div>                evconnlistener_cb cb,</div><div>                void* arg);</div></div><div><font style="font-size: 11pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">该函数调整已有</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">的回调函数和回调函数参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">该函数出现在</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">LibEvent2.0.9-rc</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">版本中</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">检查evconnlistener</span></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>evutil_socket_t evconnlistener_get_fd(struct evconnlistener* lev);</div><div>struct event_base* evconnlistener_get_base(struct evconnlistener * lev);</div></div></div><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">这些函数分别返回了监听器关联的</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">socket</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">和</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">event_base.</span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">检查错误</span></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设置一个错误回调函数</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">当在监听器上调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">accept()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数调用失败的时候收集错误信息</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在当面临一个不解决就可能锁掉进程的错误条件的时候则显得非常重要</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>typedef void ( * evconnlistener_errorcb)(struct evconnlistener* lis, void * ptr);</div><div>void evconnlistener_set_error_cb(struct evconnlistener* lev,</div><div>                    evconnlistener_errorcb errorcb);</div></div><div><br/></div></div><div style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">如果调用</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener_set_error_cb()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">函数为监听器设置一个错误回调函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">每次监听器出现错误的时候该函数都会返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">该函数接收监听器作为其第一个参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">传递到</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">evconnlistener_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">接口的参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-variant-caps: normal; font-variant-ligatures: normal;">ptr</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">作为其第二个参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">示例：一个echo服务器</span></span></div><div style="font-size: 10pt;"><br/></div><div style="font-size: 10pt;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/listener.h&gt;</div><div>#include &lt;event2/bufferevent.h&gt;</div><div>#include &lt;event2/buffer.h&gt;</div><div>#include &lt;arpa/inet.h&gt;</div><div>#include &lt;string.h&gt;</div><div>#include &lt;stdlib.h&gt;</div><div>#include &lt;stdio.h&gt;</div><div>#include &lt;errno.h&gt;</div><div>static void echo_read_cb(struct bufferevent* bev, void * ctx)</div><div>{</div><div>  <font color="#A8A8A8">  /* This callback is invoked when there is data to read on bev.*/</font></div><div>    struct evbuffer* input = bufferevent_get_input(bev);</div><div>    struct evbuffer* output = bufferevent_get_output(bev);</div><div>  <font color="#A8A8A8">  /* Copy all the data from the input buffer to the output buffer.*/</font></div><div>    evbuffer_add_buffer(output, input);</div><div>}</div><div>static void echo_event_cb(struct bufferevent* bev, short events, void * ctx)</div><div>{</div><div>    if (events &amp; BEV_EVENT_ERROR)</div><div>        perror(&quot;Error from bufferevent&quot;);</div><div>    if (events &amp; (BEV_EVENT_EOF | BEV_EVENT_ERROR))</div><div>    {</div><div>        bufferevent_free(bev);</div><div>    }</div><div>}</div><div>static void accept_conn_cb(struct evconnlistener* listener,</div><div>            evutil_socket_t fd,</div><div>            struct sockaddr* address,</div><div>            int socklen,</div><div>            void* ctx)</div><div>{</div><div>    <font color="#A8A8A8">/* We got a new connection! Set up a bufferevent for it.*/</font></div><div>    struct event_base* base = evconnlistener_get_base(listener);</div><div>    struct bufferevent* bev = bufferevent_socket_new(</div><div>            base, fd, BEV_OPT_CLOSE_ON_FREE);</div><div>    bufferevent_setcb(bev, echo_read_cb, NULL, echo_event_cb, NULL);</div><div>    bufferevent_enable(bev, EV_READ|EV_WRITE);</div><div>}</div><div>static void accept_error_cb(struct evconnlistener* listener, void * ctx)</div><div>{</div><div>    struct event_base* base = evconnlistener_get_base(listener);</div><div>    int err = EVUTIL_SOCKET_ERROR();</div><div>    fprintf(stderr, &quot;Got an error %d (%s) on the listener. &quot;</div><div>        &quot;Shutting down.\n&quot;, err, evutil_socket_error_to_string(err));</div><div>    event_base_loopexit(base, NULL);</div><div>}</div><div>int main(int argc, char** argv)</div><div>{</div><div>    struct event_base* base;</div><div>    struct evconnlistener* listener;</div><div>    struct sockaddr_in sin;</div><div>    int port = 9876;</div><div>    if (argc &gt; 1)</div><div>    {</div><div>        port = atoi(argv[1]);</div><div>    }</div><div>    if (port&lt;=0 || port&gt;65535)</div><div>    {</div><div>        puts(&quot;Invalid port&quot;);</div><div>        return 1;</div><div>    }</div><div>    base = event_base_new();</div><div>    if (!base)</div><div>    {</div><div>        puts(&quot;Couldn’t open event base&quot;);</div><div>        return 1;</div><div>    }</div><div><font color="#A8A8A8">    /* Clear the sockaddr before using it, in case there are extra*</font></div><div><font color="#A8A8A8">    platform-specific fields that can mess us up.*/</font></div><div>    memset(&amp;sin, 0, sizeof(sin));</div><div><font color="#A8A8A8">    /* This is an INET address*/</font></div><div>    sin.sin_family = AF_INET;</div><div> <font color="#A8A8A8">   /* Listen on 0.0.0.0*/</font></div><div>    sin.sin_addr.s_addr = htonl(0);</div><div>   <font color="#A8A8A8"> /* Listen on the given port.*/</font></div><div>    sin.sin_port = htons(port);</div><div>    listener = evconnlistener_new_bind(base, accept_conn_cb, NULL,</div><div>                LEV_OPT_CLOSE_ON_FREE|LEV_OPT_REUSEABLE, -1,</div><div>                (struct sockaddr * )&amp;sin, sizeof(sin));</div><div>    if (!listener)</div><div>    {</div><div>        perror(&quot;Couldn’t create listener&quot;);</div><div>        return 1;</div><div>    }</div><div>    evconnlistener_set_error_cb(listener, accept_error_cb);</div><div>    event_base_dispatch(base);</div><div>    return 0;</div><div>}</div></div><div><br/></div></div><div style="font-size: 10pt;"><span style="font-size: 11pt;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: 10pt;"><br/></div><div style="font-size: 10pt;"><br/></div></div><div><br/></div></span>
</div></body></html> 