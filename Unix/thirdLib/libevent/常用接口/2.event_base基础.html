<html>
<head>
  <title>2.event_base基础</title>
  <basefont face="Verdana" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604762 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: Verdana;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="935"/>
<h1>2.event_base基础</h1>

<div>
<span><div><div><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">创建event_base</span></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在你能使用任何感兴趣的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">LibEvent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数之前</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">你需要分配一个或多个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">每个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体拥有系些列的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">并且可以通过轮询判断哪个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">是激活的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10.5pt;"><br/></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果一个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设置为使用锁定</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在多个线程中访问它是安全的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">然而只能在一个线程中去处理其事件循环</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果你想在多线程中轮询</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">IO,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">那么你需要为每个线程分配一个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">未来版本将会支持</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">多线程运行</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">每个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">都有一个方法或后台用来决定哪个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">已经准备好了</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">已经验证的可行方法是</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">select</span></span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">poll</span></span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">epoll</span></span></div><div><span style="font-size: 10pt; font-family: 宋体;">kquene</span></div><div><span style="font-size: 10pt; font-family: 宋体;">devpoll</span></div><div><span style="font-size: 10pt; font-family: 宋体;">evport</span></div><div><span style="font-size: 10pt; font-family: 宋体;">win32</span></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">用户可以通过一些环境变量来禁用某些后台</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果想要</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">kqueue</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">后端</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设置变量</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">EVENT_NOKQUEUE,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">诸如此类</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果你想要从程序内部关闭后台</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">请查看下面的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_config_avoid_method()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">方法.</span></font></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10.5pt;"><br/></span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10.5pt;"><br/></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-family: 宋体; font-weight: bold;">创建默认的event_base:</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt; font-family: 宋体;">#include &lt;event2/event.h&gt;</span></div><div><span style="font-size: 11pt; font-family: 宋体;">struct event_base *event_base_new(void);</span></div><div><span style="font-size: 11pt; font-family: 宋体;">struct event_base *event_base_new(void)</span></div><div><span style="font-size: 11pt; font-family: 宋体;">{   </span></div><div><span style="font-size: 11pt; font-family: 宋体;">    struct event_base *base = NULL;</span></div><div><span style="font-size: 11pt; font-family: 宋体;">    struct event_config *cfg = event_config_new();</span></div><div><span style="font-size: 11pt; font-family: 宋体;">    if (cfg) {</span></div><div><span style="font-size: 11pt; font-family: 宋体;">        base = event_base_new_with_config(cfg);</span></div><div><span style="font-size: 11pt; font-family: 宋体;">        event_config_free(cfg);</span></div><div><span style="font-size: 11pt; font-family: 宋体;">    }   </span></div><div><span style="font-size: 11pt; font-family: 宋体;">    return base;</span></div><div><span style="font-size: 11pt; font-family: 宋体;">}</span></div></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数分配和返回了一个默认参数的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">它检验环境变量然后分配了一个指向新的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的指针</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果错误则返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">NULL.</span></font></div><div><br/></div><div><span style="font-family: 宋体;">如果你想要更多控制你获取到的那种event_base,就需要event_config,event_config是一个不透明结构体,它保存了你设置给event_base的配置信息.当想创建一个event_base时,需要将event_config传入event_base_new_with_config().</span></div><div><br/></div><div><span style="font-family: 宋体;">要用这些函数来创建一个新的event_base,你需要调用event_config_new()函数来分配一个新的event_config,然后调用别的函数,用event_config告诉它你的需求.最后,调用event_base_new_with_config()函数来获取一个新的event_base,当这些完成后就可以使用event_config_free()函数来释放event_config.</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_config_avoid_method(struct event_config *cfg, const char *method);</div><div>enum event_method_feature</div><div>{</div><div>    EV_FEATURE_ET = 0x01,</div><div>    EV_FEATURE_O1 = 0x02,</div><div>    EV_FEATURE_FDS = 0x04,</div><div>};</div><div>int event_config_require_features(struct event_config *cfg,</div><div>enum event_method_feature feature);</div><div>enum event_base_config_flag</div><div>{</div><div>    EVENT_BASE_FLAG_NOLOCK = 0x01,</div><div>    EVENT_BASE_FLAG_IGNORE_ENV = 0x02,</div><div>    EVENT_BASE_FLAG_STARTUP_IOCP = 0x04,</div><div>    EVENT_BASE_FLAG_NO_CACHE_TIME = 0x08,</div><div>    EVENT_BASE_FLAG_EPOLL_USE_CHANGELIST = 0x10,</div><div>    EVENT_BASE_FLAG_PRECISE_TIMER = 0x20</div><div>};</div><div>int event_config_set_flag(struct event_config *cfg,enum event_base_config_flag flag);</div></div><div><font style="font-size: 9pt;"><br/></font></div><div><span style="font-size: 10pt; color: rgb(255, 0, 0); font-family: 宋体;">调用event_config_avoid_method()可以通过名字让libevent避免使用特定的可用后端.</span></div><div><span style="font-size: 10pt; font-family: 宋体;">调event_config_require_feature()让 libevent不使用不能提供所有指定特征的后端.</span></div><div><span style="font-size: 10pt; font-family: 宋体;">调用event_config_set_flag()让libevent在创建event_base时设置一个或者多个将在下面介绍的运行时标志.</span></div><div><br/></div><div><br/></div><div><span style="font-family: 宋体;">event_config_require_features可以识别的特征：</span></div><div><span style="font-size: 10pt; box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EV_FEATURE_ET</span><span style="font-size: 10pt; box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要</span><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">求支持边沿触发的后端</span></span></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EV_FEATURE_O1</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要求添加、删除单个事件</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或者确定哪个事件激活的操作是</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">O(1)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">复杂度的后端</span></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EV_FEATURE_FDS</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要求支持任意文件描述符</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而不仅仅是套接字的后端</span></font></div><div><br/></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_config_set_flag()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可识别的选项值有</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EVENT_BASE_FLAG_NOLOCK</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不要为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">分配锁</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设置这个选项可以为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">节省一点用于锁定和解锁的时间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">但是让在多个线程中访问</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">成为不安全的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EVENT_BASE_FLAG_IGNORE_ENV</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">选择使用的后端时</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不要检测</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">EVENT_*</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">环境变量</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">使用这个标志需要三思</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这会让用户更难调试你的程序与</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">libevent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的交互</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EVENT_BASE_FLAG_STARTUP_IOCP</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">仅用于</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> Windows,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">让</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> libevent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在启动时就启用任何必需的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">IOCP</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">分发逻辑</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而不是按需启用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><span style="font-size: 10pt; font-family: 宋体; font-weight: bold;">EVENT_BASE_FLAG_EPOLL_USE_CHANGELIST:</span><span style="font-size: 10pt; font-family: 宋体;">告诉 libevent,如果决定使用epoll后端,可以安全地使用更快的基于 changelist的后端.epoll-changelist后端可以在后端的分发函数调用之间,同样的fd多次修改其状态的情况下,避免不必要的系统调用.但是如果传递任何使用 dup ()或者其变体克隆的 fd给libevent, epoll-changelist后端会触发一个内核bug,导致不正确的结果.在不使用epoll后端的情况下,这个标志是没有效果的.也可以通过设置 </span><span style="font-size: 10pt; font-family: 宋体; font-weight: bold;">EVENT_EPOLL_USE_CHANGELIST</span><span style="font-size: 10pt; font-family: 宋体;">:环境变量来打开epoll-changelist选项.</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">EVENT_BASE_FLAG_NO_CACHE_TIME</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不是在事件循环每次准备执行超时回调时检测当前时间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而是在每次超时回调后进行检测</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">注意</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这会消耗更多的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">CPU</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">时间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">上述操作</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_config</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的函数都在成功时返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">失败时返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">-1.</span></font></div><div><br/></div><div><br/></div><div><span style="font-family: 宋体;">设置event_config,请求OS不能提供的后端是很容易的.比如说,对于libevent2.0.1-alpha,在Windows中是没有O(1)后端的;</span><span style="font-family: 宋体; font-weight: bold;">在Linux中也没有同时提供 EV_FEATURE_FDS和EV_FEATURE_O1特征的后端</span><span style="font-family: 宋体;">.如果创建了 libevent不能满足的配置,event_base_new_with_config()会返回NULL.</span></div><div><br/></div><div><span style="font-family: 宋体;">设置边沿触发：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>struct event_config *cfg;</div><div>struct event_base *base;</div><div>int i;</div><div><font color="#A8A8A8">/* My program wants to use edge-triggered events if at all possible. So I’ll try to get a base twice: Once insisting on edge-triggered IO, and once not.*/</font></div><div>for (i=0; i&lt;2; ++i)</div><div>{</div><div>    cfg = event_config_new();</div><div>    /* I don’t like select.*/</div><div>  <font color="#FF0000">  event_config_avoid_method(cfg, &quot;select&quot;);//避免使用select</font></div><div>    if (i == 0)</div><div>        <font color="#FF0000">event_config_require_features(cfg, EV_FEATURE_ET);//设置边沿触发</font></div><div>    <font color="#FF0000">base = event_base_new_with_config(cfg);//返回设置后生成event_base结构体</font></div><div>    <font color="#FF0000">event_config_free(cfg);//释放掉event_config结构</font></div><div>    if (base)</div><div>        break;</div><div><font color="#A8A8A8">    /* If we get here, event_base_new_with_config() returned NULL. If this is the     first time around the loop, we’ll try again without setting EV_FEATURE_ET. If     this is the second time around the loop, we’ll give up.*/</font></div><div>}</div></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; font-family: 宋体; font-weight: bold;">事件循环：</span></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">有了</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">并且有一些</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">注册到其中</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">(</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">关于怎样创建和注册</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">请参考下一章节</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">),</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">就需要等待这些</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">通知你他们发生了什么</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#define EVLOOP_ONCE 0x01</div><div>#define EVLOOP_NONBLOCK 0x02</div><div>#define EVLOOP_NO_EXIT_ON_EMPTY 0x04</div><div>int event_base_loop(struct event_base *base, int flags);</div></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体;">通常event_base_loop()函数运行一个event_base直到其中再无event注册进来.循环运行,然后不断重复判断是否有已经注册的event触发(例如如果读event的文件描述符准备读或者event的超时即将到来).一旦这些情况发生,就会标记所有的触发event为激活状态,然后开始运行这些事件.</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-family: 宋体;">设置flags参数一个或多个标记可改变event_base_loop()的行为.设置EVLOOP_ONCE循环将会有event激活,然后运行这些event,直到再无event后返回.设置</span><span style="font-family: 宋体;">EVLOOP_NONBLOCK</span><span style="font-family: 宋体;">循环不会再等待有event触发,只会检测是否有event做好准备立</span><span style="font-family: 宋体;">刻触发,有则运行其回调函数.</span></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">通常，一旦没有挂起或活动事件，循环就会退出。</span></span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">您可以通过传递EVLOOP_NO_EXIT_ON_EMPTY标志来覆盖此行为 - 例如，如果您要从其他某个线程添加事件。</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果设置了EVLOOP_NO_EXIT_ON_EMPTY，则循环将继续运行，直到有人调用event_base_loopbreak（）或调用event_base_loopexit（），否则会发生错误。</span></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">完成后，event_base_loop（）如果正常退出则返回0，如果由于后端中的某些未处理错误而退出则返回-1，如果退出则返回1，因为没有更多挂起或活动事件。</span></span></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">为了帮助理解</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这里有一个与</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base_loop</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">算法相似的总结</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">伪代码</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">while (any events are registered with the loop,or EVLOOP_NO_EXIT_ON_EMPTY was set)</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">{</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    if (EVLOOP_NONBLOCK was set, or any events are already active)</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    If any registered events have triggered, mark them active.</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    else</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    Wait until at least one event has triggered, and mark it active.</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    for (p = 0; p &lt; n_priorities; ++p)</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    {</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">        if (any event with priority of p is active)</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">        {</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            Run all active events with priority of p.</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            break; /*Do not run any events of a less important priority*/</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">        }</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    }</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    if (EVLOOP_ONCE was set or EVLOOP_NONBLOCK was set)</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    break;</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">}</span></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-family: 宋体;">同时为了方便，提供了这个函数：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_base_dispatch(struct event_base *base);  </div></div><div><span style="font-family: 宋体;">event_base_dispatch ()等同于没有设置标志的 event_base_loop ()所以event_base_dispatch()将一直运行,直到</span><span style="font-family: 宋体; font-weight: bold;">没有已经注册的事件</span><span style="font-family: 宋体;">了,或者调用event_base_loopbreak()或者event_base_loopexit()为止.</span></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">停止循环：</span></span></div><div><span style="font-size: 10pt; font-family: 宋体;">如果您希望活动事件循环在从中删除所有事件之前停止运行，则可以调用两个稍微不同的函数。</span></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">int event_base_loopexit(struct event_base *base,const struct timeval *tv);</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">int event_base_loopbreak(struct event_base *base);</span></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_base_loopexit()</span></span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">让</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">在给定时间之后停止</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">循环</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">tv</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">NULL,event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">会立</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">即停止循环</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">没有延时</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">当前正在执行任何激活事件的回调</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">则回调会继续运行</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">直到运行完所有激活事件的回调之才退出</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base_loopbreak()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">让</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">立即退出循环</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">它与</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> event_base_loopexit(base,NULL)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的不同在于</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">当前正在执行激活事件的回调</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">它将在执行完当前正在处理的事件</span>后立即退出</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><span style="font-family: 宋体;">注：event_base_loopexit(base,NULL)和 event_base_loopbreak(base)</span><span style="font-family: 宋体; font-weight: bold;">在事件循环没有运行时</span><span style="font-family: 宋体;">的行为不同:前者安排下一次事件循环在下一轮回调完成后立即停止(就好像带EVLOOP_ONCE标志调用一样);后者却仅仅停止当前正在运行的循环,</span><span style="font-family: 宋体; font-weight: bold;">如果事件循环没有运行,则没有任何效果.</span></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这两个函数都在成功时返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">0,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">失败时返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">-1.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">示例</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">立刻关闭</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 10pt;">#include &lt;event2/event.h&gt;</font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">/* Here’s a callback function that calls loopbreak */</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">void cb(int sock, short what, void *arg)</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">{</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">    struct event_base *base = arg;</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">    event_base_loopbreak(base);</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">}//回调函数被调用时，处理完此事件（及此函数）后退出</font></font></div><div><font style="font-size: 10pt;">void main_loop(struct event_base *base, evutil_socket_t watchdog_fd)</font></div><div><font style="font-size: 10pt;">{</font></div><div><font style="font-size: 10pt;">    struct event *watchdog_event;</font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    /* Construct a new event to trigger whenever there are any bytes to</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    read from a watchdog socket. When that happens, we’ll call the</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    cb function, which will make the loop exit immediately without</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    running any other active events at all.*/</font></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;">    watchdog_event = event_new(base, watchdog_fd, EV_READ, cb, base);</font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;">    event_add(watchdog_event, NULL);</font></div><div><font style="font-size: 10pt;">   <font color="#FF0000"> event_base_dispatch(base);//设置不断运行</font></font></div><div><font style="font-size: 10pt;">}</font></div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">示例</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">执行事件循环</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> 10</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">秒后退出</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 10pt;">#include &lt;event2/event.h&gt;</font></div><div><font style="font-size: 10pt;">void run_base_with_ticks(struct event_base *base)</font></div><div><font style="font-size: 10pt;">{</font></div><div><font style="font-size: 10pt;">   <font color="#FF0000"> struct timeval ten_sec;</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">    ten_sec.tv_sec = 10;</font></font></div><div><font style="font-size: 10pt;"><font color="#FF0000">    ten_sec.tv_usec = 0;//设置时间为10s+0μs</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    /* Now we run the event_base for a series of 10-second intervals, printing</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    &quot;Tick&quot; after each. For a much better way to implement a 10-second</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">    timer, see the section below about persistent timer events.*/</font></font></div><div><font style="font-size: 10pt;">    while(1)</font></div><div><font style="font-size: 10pt;">    {</font></div><div><font style="font-size: 10pt;">        <font color="#A8A8A8">/* This schedules an exit ten seconds from now.*/</font></font></div><div><font style="font-size: 10pt;">        <font color="#FF0000">event_base_loopexit(base, &amp;ten_sec);//设置10s后退出event_base循环</font></font></div><div><font style="font-size: 10pt;">   <font color="#FF0000">     event_base_dispatch(base);//再次开启循环</font></font></div><div><font style="font-size: 10pt;">  <font color="#FF0000">      puts(&quot;Tick&quot;);//打印信息</font></font></div><div><font style="font-size: 10pt;">    }</font></div><div><font style="font-size: 10pt;">}    </font></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-family: 宋体;">有时候需要知道event_base_dispatch()或event_base_loop()的调用是正常退出的,还是因为用event_base_loopexit()或者event_base_break()而退出的.可以调用下述函数来确定是否调用了loopexit或者break函数.</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_base_got_exit(struct event_base *base);</div><div>int event_base_got_break(struct event_base *base);</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这两个函数分别会在循环是因为调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;"> event_base_loopexit()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或者</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;"> event_base_break()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而退出的时候返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;"> true,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">否则返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;"> false.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">下次启动事件循环的时候</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这些值会被重设。</span></font></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; font-family: 宋体; font-weight: bold;">重新检查事件</span></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">通常，Libevent会检查事件，然后运行具有最高优先级的所有活动事件，然后再次检查事件，依此类推。</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">但有时您可能希望在当前回调运行后立即停止Libevent，并告诉它再次扫描。</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">通过类比event_base_loopbreak（），您可以使用函数event_base_loopcontinue（）来完成此操作。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_base_loopcontinue(struct event_base *);</div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果我们当前没有运行事件回调，则调用event_base_loopcontinue（）无效。</span></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; font-family: 宋体;">检查内部事件缓存：</span></span></div><div style="letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="font-size: medium; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">有时你想得到事件回调中当前时间的近似视图，并且你想在不调用gettimeofday（）的情况下得到它（大概是因为你的操作系统实现了gettimeofday（）作为系统调用，你试图避免系统调用高架）。</span></span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在回调中，你可以向Libevent询问它开始执行这一轮回调时的当前时间：</span></div><div style="font-size: medium; margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_base_gettimeofday_cached(struct event_base *base,struct timeval *tv_out);</div></div><div><br/></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果当前正在执行回调</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,event_base_gettimeofday_cached()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数设置</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;"> tv_out</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">参数的值为缓存的时间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">否则</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;"> evutil_gettimeofday()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">获取真正的当前时间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">成功时函数返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">0,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">失败时返回负数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">注意</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">因为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> libevent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在开始执行回调的时候缓存时间值</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">所以这个值至少是有一点不精确的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> .</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果回调执行很长时间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这个值将非常不精确</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要强制刷新缓存</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">你可以调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_base_update_cache_time(struct event_base *base);  </div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">成功时返回0，失败时返回-1，如果base没有运行其事件循环，则无效。</span></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">转存event_base的状态</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">void event_base_dump_events(struct event_base *base, FILE *f);   </span></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">有关调试程序（或调试Libevent！）的帮助，您有时可能需要在event_base中添加的所有事件的完整列表及其状态。</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">调用event_base_dump_events（）会将此列表写入提供的指定文件。</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">该清单应该是</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">人类</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可读的;</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">它的格式</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">将</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在未来版本的Libevent中改变。（啊，这该死的谷歌翻译，我喜欢！！！）</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">在event_base中的每个event上运行一个函数</span></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">typedef int (*event_base_foreach_event_cb)(const struct event_base *,</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                        const struct event *,</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                        void *);</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">int event_base_foreach_event(struct event_base *base,</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                event_base_foreach_event_cb fn,</span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">                void *arg);   </span></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">您可以使用event_base_foreach_event（）迭代与event_base（）关联的每个当前活动或挂起事件。</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">提供的回调将在每个事件中以未指定的顺序调用一次。</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">event_base_foreach_event（）的第三个参数将作为第三个参数传递给每次回调调用。</span></div></div><div style="font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">回调函数必须返回0才能继续迭代，或者其他一些整数停止迭代。</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">无论回调函数最终返回什么值，都将由event_base_foreach_function（）返回。</span></div></div><div style="font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">您的回调函数</span><span style="-en-paragraph:true;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">不得</span></span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">修改它接收的任何事件，或者向事件库添加或删除任何事件，或以其他方式修改与事件库相关的任何事件，或者可能发生未定义的行为，包括崩溃和堆栈溢出</span>。</span></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">处理事件</span></font></span></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">libevent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的基本操作单元是事件</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">每个事件代表一组条件的集合</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这些条件包括</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><ul><li><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">准备好读取或写入的文件描述符。</span></font></span></div></li><li><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">文件描述符变为就绪状态</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">可以读取或者写入</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">(</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">仅对于边沿触发</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> IO</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span></font></div></li><li><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="宋体" style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">超时事件</span></font></span></div></li><li><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="宋体" style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">发生某信号</span></font></span></div></li><li><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="宋体" style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">用户触发事件</span></font></span></div></li></ul><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-family: 宋体;">所有事件具有相似的生命周期.</span></div><div><span style="font-family: 宋体;">调用</span><span style="font-family: 宋体;">libevent函数设置事件并且关联到event_base之后,事件进入&quot;已初始化(initialized)&quot;状态.</span></div><div><span style="font-family: 宋体;">此时可以将事件添加到event_base中,这使之进入&quot;未决(pending)&quot;状态.</span></div><div><span style="font-family: 宋体;">在未决状态下,如果触发事件的条件发生(比如说,文件描述符的状态改变,或者超时时间到达),则事件进入&quot;激活(active)&quot;状态,(用户提供的)事件回调函数将被执行.如果配置为&quot;持久的(persistent)&quot;,事件将保持为未决状态.</span></div><div><span style="font-family: 宋体;">否则,执行完回调后,事件不再是未决的.</span></div><div><span style="font-family: 宋体;">删除操作可以让未决事件成为非未决(已初始化)的;添加操作可以让非未决事件再次成为未决的.</span></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">构造事件对象</span></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">#define EV_TIMEOUT 0x01</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">#define EV_READ 0x02</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">#define EV_WRITE 0x04</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">#define EV_SIGNAL 0x08</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">#define EV_PERSIST 0x10</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">#define EV_ET 0x20</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">typedef void ( * event_callback_fn)(evutil_socket_t, short, void* );</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">struct event* event_new(struct event_base * base, evutil_socket_t fd,</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">short what, event_callback_fn cb,void* arg);</font></span></div><div><span style="color: rgb(0, 0, 0); font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-family: 宋体;">void event_free(struct event* event);</font></span></div></div><div><br/></div><div><span style="font-family: 宋体; font-weight: bold;">event_new()试图分配和构造一个用于base的新的事件. </span></div><ul><li><div><span style="font-family: 宋体;">what参数是上述标志的集合.</span></div></li><li><div><span style="font-family: 宋体;">如果fd非负,则它是将被观察其读写事件的文件.</span></div></li><li><div><span style="font-family: 宋体;">事件被激活时, libevent将调用cb函数,传递这些参数:文件描述符fd,表示所有被触发事件的位字段,以及构造事件时的arg参数.</span></div></li><li><div><span style="font-family: 宋体;">发生内部错误,或者传入无效参数时, event_new()将返回NULL.</span></div></li><li><div><span style="font-family: 宋体;">所有新创建的事件都处于已初始化和非未决状态,调用event_add ()可以使其成为未决的.</span></div></li><li><div><span style="font-family: 宋体;">要释放事件,调用event_free().</span></div></li><li><div><span style="font-family: 宋体;">对未决或者激活状态的事件调用event_free()是安全的:在释放事件之前,函数将会使事件成为非激活和非未决的 .</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/event.h&gt;</div><div>void cb_func(evutil_socket_t fd, short what, void* arg)</div><div>{</div><div>    const char* data = arg;</div><div>    printf(&quot;Got an event on socket %d:%s%s%s%s [%s]&quot;,</div><div>        (int) fd,</div><div>        (what&amp;EV_TIMEOUT) ? &quot; timeout&quot; : &quot;&quot;,</div><div>        (what&amp;EV_READ) ? &quot; read&quot; : &quot;&quot;,</div><div>        (what&amp;EV_WRITE) ? &quot; write&quot; : &quot;&quot;,</div><div>        (what&amp;EV_SIGNAL) ? &quot; signal&quot; : &quot;&quot;,</div><div>        data);</div><div>}//回调函数</div><div>void main_loop(evutil_socket_t fd1, evutil_socket_t fd2)</div><div>{</div><div>    struct event* ev1, * ev2;</div><div>    struct timeval five_seconds = {5,0};</div><div>    <font color="#FF0000">struct event_base * base = event_base_new();//创建一个event_base</font></div><div><font color="#A8A8A8">/* The caller has already set up fd1, fd2 somehow, and make them nonblocking.*/</font></div><div>    <font color="#FF0000">ev1 = event_new(base, fd1, EV_TIMEOUT|EV_READ|EV_PERSIST, cb_func,</font></div><div><font color="#FF0000">        (char * )&quot;Reading event&quot;);//分配一个用于event_base的事件</font></div><div><font color="#FF0000">    ev2 = event_new(base, fd2, EV_WRITE|EV_PERSIST, cb_func,</font></div><div><font color="#FF0000">        (char * )&quot;Writing event&quot;);//分配一个用于event_base的事件</font></div><div>   <font style="color: rgb(255, 0, 0);"> event_add(ev1</font><font color="#FF0000">, &amp;five_seconds);//使事件由非未决变为未决状态，超时事件为5s</font></div><div><font color="#FF0000">    event_add(ev2, NULL);//使事件由非未决变为未决状态</font></div><div>    <font color="#FF0000">event_base_dispatch(base);//不断运行此event_base</font></div><div><font color="#FF0000">}</font></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; font-family: 宋体; font-weight: bold;">事件标志</span></span></div><ul><li><div><span style="font-family: 宋体; font-weight: bold;">EV_TIMEOUT:</span><span style="font-family: 宋体;">这个标志表示某超时时间流逝后事件成为激活的.构造事件的时候, EV_TIMEOUT标志是缺省的:可以在添加事件的时候设置超时,也可以不设置.超时发生时,回调函数的what参数将带有这个标志.</span></div></li><li><div><span style="font-family: 宋体; font-weight: bold;">EV_READ:</span><span style="font-family: 宋体;">表示指定的文件描述符已经就绪,可以读取的时候,事件将成为激活的.</span></div></li><li><div><span style="font-family: 宋体; font-weight: bold;">EV_WRITE:</span><span style="font-family: 宋体;">表示指定的文件描述符已经就绪,可以写入的时候,事件将成为激活的.</span></div></li><li><div><span style="font-family: 宋体; font-weight: bold;">EV_SIGNAL:</span><span style="font-family: 宋体;">用于实现信号检测,请看下面的&quot;构造信号事件&quot;节.</span></div></li><li><div><span style="font-family: 宋体; font-weight: bold;">EV_PERSIST:</span><span style="font-family: 宋体;">表示事件是&quot;持久的&quot;,请看下面的&quot;关于事件持久性&quot;节.</span></div></li><li><div><span style="font-family: 宋体; font-weight: bold;">EV_ET:</span><span style="font-family: 宋体;">表示如果底层的event_base后端支持边沿触发事件,则事件应该是边沿触发的.这个标志影响EV_READ和EV_WRITE的语义.</span></div></li></ul><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以有任意多个事件因为同样的条件而未决</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">比如说</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以有两个事件因为某个给定的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">fd</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">已经就绪</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以读取而成为激活的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这种情况下</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">多个事件回调被执行的次序是不确定的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><span style="font-size: 10pt; font-family: 宋体; font-weight: bold;">关于事件持久性</span></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">默认情况下</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">每当未决事件成为激活的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">(</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">因为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">fd</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">已经准备好读取或者写入</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或者因为超时</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">事件将在其回调被执行前成为非未决的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果想让事件再次成为未决的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以在回调函数中再次对其调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_add</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">(</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果设置了</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">EV_PERSIST</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">标志</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">事件就是持久的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这意味着即使其回调被激活</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">事件还是会保持为未决状态</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果想在回调中让事件成为非未决的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以对其调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_del</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">(</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">每次执行事件回调的时候</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">持久事件的超时值会被复位</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt; padding: 0px; line-height: 26px; overflow-x: auto; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt; padding: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">因此</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">如果具有</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">EV_READ|EV_PERSIST</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">标志</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">以及</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">5</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">秒的超时值</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">则事件将在以下情况下成为激活的</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">:</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-size: 10pt; font-family: 宋体; line-height: 26px;">套接字已经准备好被读取</span></span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-size: 10pt; outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-family: 宋体; line-height: 26px;">从最后一次成为激活的开始</span><span style="font-size: 10pt; outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-family: 宋体; line-height: 26px;">,</span><span style="font-size: 10pt; outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-family: 宋体; line-height: 26px;">已经逝去</span><span style="font-size: 10pt; outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-family: 宋体; line-height: 26px;">5</span><span style="font-size: 10pt; outline: 0px; overflow-x: auto; overflow-wrap: break-word; font-family: 宋体; line-height: 26px;">秒</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="outline: 0px; font-size: 12pt; overflow-wrap: break-word;"><br/></span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font style="font-size: 10pt;"><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; color: rgb(51, 51, 51); font-family: 宋体; font-weight: bold; line-height: 30px;">创建一个用本身作为回调函数参数的</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; color: rgb(51, 51, 51); font-family: 宋体; font-weight: bold; line-height: 30px;">event</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">很多情况下你想要创建一个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">并且用自身作为回调函数参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">不能只传一个指向</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">的指针作为参数到函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event_new(),</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">因为它还未实际存在</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">为了解决这个问题</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">可以使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event_self_cbkarg()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: Calibri; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><br/></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>void* event_self_cbarg();</div></div></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event_self_cbarg()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">函数返回了一个传入到</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">回调函数作为参数的魔幻指针</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">该指针告诉</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">去创建一个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">并且把自身作为回调函数参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-family: 宋体; line-height: 26px;">示例：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/event.h&gt;</div><div>static int n_calls = 0;</div><div>void cb_func(evutil_socket_t fd, short what, void* arg)</div><div>{</div><div>    struct event* me = arg;</div><div>    printf(&quot;cb_func called %d times so far.\n&quot;, ++n_calls);</div><div>  <font color="#FF0000">  if (n_calls &gt; 100)</font></div><div><font color="#FF0000">        event_del(me);//静态变量大于100时，使事件ev成为非未决状态，及没有挂起事件，循环退出</font></div><div>}</div><div>void run(struct event_base* base)</div><div>{</div><div>    struct timeval one_sec = { 1, 0 };</div><div>    struct event* ev;</div><div>  <font color="#A8A8A8">  /* We’re going to set up a repeating timer to get called called 100 times.*/</font></div><div>    ev = event_new(base, -1, EV_PERSIST, cb_func, event_self_cbarg());</div><div>  <font color="#FF0000">  event_add(ev, &amp;one_sec);//设置超时时间为1s，及每过1秒，事件ev会变为激活状态，并调用回调函数</font></div><div>   <font color="#FF0000"> event_base_dispatch(base);//一直运行</font></div><div>}</div></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><br/></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">超时事件</span></span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">为方便起见，有一组以evtimer_开头的宏，您可以使用它们代替event_ *调用来</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">分配和操作纯超时事件</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">。</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">使用这些宏除了提高代码的清晰度之外没有任何好处。</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><br/></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#define evtimer_new(base, callback, arg) \</div><div>    event_new((base), -1, 0, (callback), (arg))</div><div>#define evtimer_add(ev, tv) \</div><div>    event_add((ev),(tv))</div><div>#define evtimer_del(ev) \</div><div>    event_del(ev)</div><div>#define evtimer_pending(ev, tv_out) \</div><div>    event_pending((ev), EV_TIMEOUT, (tv_out))</div></div><div><br/></div></div><div><br/></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><br/></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-family: 宋体; line-height: 26px;">构造信号事件</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-family: 宋体; line-height: 26px;">了解Linux信号和信号函数这里就非常好懂了</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">LibEvent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">也支持监控</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">POSIX</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">格式的信号</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">构造一个信号句柄</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">使用下面的方法</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">:</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">接口：</span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">#define evsignal_new（base，signum，cb，arg）\</span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">    event_new（base，signum，EV_SIGNAL | EV_PERSIST，cb，arg）</span></div></div></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-family: 宋体; line-height: 26px;">示例</span></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>struct event* hup_event;</div><div>struct event_base* base = event_base_new();</div><div>/* call sighup_function on a HUP signal*/</div><div>hup_event = evsignal_new(base, SIGHUP, sighup_function, NULL);</div></div><div><br/></div></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">参数与event_new相同，除了我们提供信号编号而不是文件描述符。</span></div><div style="font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">请注意，信号回调在信号发生后在事件循环中运行，因此它们可以安全地调用您不应该从常规POSIX信号处理程序调用的函数。</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">警告：</span> <span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不要在信号事件上设置超时。它可能不受支持。[FIXME：这是真的吗？]</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在处理信号事件时，还可以使用一组便捷宏。</span></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#define evsignal_add(ev, tv) \</div><div>    event_add((ev),(tv))</div><div>#define evsignal_del(ev) \</div><div>    event_del(ev)</div><div>#define evsignal_pending(ev, what, tv_out) \</div><div>    event_pending((ev), (what), (tv_out))</div></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; line-height: 26px; overflow-x: auto; overflow-wrap: break-word;"></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">注意：</span></span></font></div><div style="font-size: medium; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">对于目前版本的Libevent，大多数后端，每个进程一次只能有一个event_base可以监听信号。</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">如果您同时将信号事件添加到两个event_bases中 - 即使信号不同！ - 只有一个event_base将接收信号。</span><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">kqueue后端没有此限制。</span></div></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt 0px; padding: 0px; overflow-x: auto; overflow-wrap: break-word;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">不用堆分配来设置事件</span></span></font></div><div style="box-sizing: border-box; outline: 0px; margin: 0pt; padding: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">对于性能或者别的原因</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">人们习惯于分配</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">作为大结构体的一部分</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">对于每次</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">使用</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">是这样保存</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">的</span><span style="box-sizing: border-box; outline: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">:</span></font></div><ul><li><div style="box-sizing: border-box; outline: 0px; margin: 0pt; padding: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">内存分配器在堆上分配一个小的对象的开销</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span></font></div></li><li><div style="box-sizing: border-box; outline: 0px; margin: 0pt; padding: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">从指向</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">的指针取值的时间开销</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span></font></div></li><li><div style="box-sizing: border-box; outline: 0px; margin: 0pt; padding: 0px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">由于</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">不在缓存中造成缓存丢失而引起的时间开销</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">.</span></font></div></li></ul><div style="letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin-top: 1em; margin-bottom: 1em;"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这种方式可能会破坏</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">LibEvent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">版本之间的二进制兼容性</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">因为版本间的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体大小不统一</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这种方式开销很小</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">也不会影响其他程序运行</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">你应该坚持使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">来分配</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">除非你在堆上分配</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的时候遭受了很严重的性能问题</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果以后的版本使用的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体比你当前使用的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体大那么使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_assign()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">会导致很难排查的错误</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">接口：</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">int event_assign(    struct event* event,</span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            struct event_base * base,</span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            evutil_socket_t fd,</span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            short what,</span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            void (*callback)(evutil_socket_t, short, void*),</span></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">            void * arg);</span></div></div><div><br/></div></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">除了</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">参数必须指向一个未初始化的事件之外</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,event_assign()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的参数与</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> event_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的参数相同</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">成功时函数返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果发生内部错误或者使用错误的参数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">-1.</span></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;-en-paragraph:true;">示例：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="color: rgb(0, 0, 0);">#include &lt;event2/event.h&gt;</div><div><font color="#A8A8A8">/* Watch out! Including event_struct.h means that your code will</font></div><div><font color="#A8A8A8">not be binary-compatible with future versions of Libevent.*/</font></div><div style="color: rgb(0, 0, 0);">#include &lt;event2/event_struct.h&gt;</div><div style="color: rgb(0, 0, 0);">#include &lt;stdlib.h&gt;</div><div style="color: rgb(0, 0, 0);">struct event_pair</div><div style="color: rgb(0, 0, 0);">{</div><div style="color: rgb(0, 0, 0);">    evutil_socket_t fd;</div><div><span style="color: rgb(0, 0, 0);">   </span><font color="#FF0000"> struct event read_event;</font></div><div><font color="#FF0000">    struct event write_event;//直接创建了event结构体而不是event*</font></div><div style="color: rgb(0, 0, 0);">};</div><div style="color: rgb(0, 0, 0);">void readcb(evutil_socket_t, short, void* );</div><div style="color: rgb(0, 0, 0);">void writecb(evutil_socket_t, short, void* );</div><div style="color: rgb(0, 0, 0);">struct event_pair* event_pair_new(struct event_base * base, evutil_socket_t fd)</div><div style="color: rgb(0, 0, 0);">{</div><div style="color: rgb(0, 0, 0);">    struct event_pair* p = malloc(sizeof(struct event_pair));</div><div style="color: rgb(0, 0, 0);">    if (!p) return NULL;</div><div style="color: rgb(0, 0, 0);">    p-&gt;fd = fd;</div><div><span style="color: rgb(0, 0, 0);">   </span><font color="#FF0000"> event_assign(&amp;p-&gt;read_event, base, fd, EV_READ|EV_PERSIST, readcb, p);</font></div><div><font color="#FF0000">    event_assign(&amp;p-&gt;write_event, base, fd, EV_WRITE|EV_PERSIST, writecb, p);//直接对分配的内存进行操作而不是返回一个event结构的地址给event*指针，而完全的避免了上述缺点</font></div><div style="color: rgb(0, 0, 0);">    return p;</div><div style="color: rgb(0, 0, 0);">}</div></div><div><br/></div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">您还可以使用event_assign（）初始化堆栈分配或静态分配的事件。</span></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">警告</span></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不要对已经在 event_base中未决的事件调用 event_assign(),这可能会导致难以诊断的错误.如果已经初始化和成为未决的,调用 event_assign()之前需要调用 event_del().</span></div><div><span style="font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">libevent提供了方便的宏将 event_assign()用于仅超时事件或者信号事件.</span></div><div><br/></div><div><span style="font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">接口：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#define evtimer_assign（event，base，callback，arg）\</div><div>    event_assign（event，base，-1,0，callback，arg）</div><div>#define evsignal_assign（event，base，signum，callback，arg）\</div><div>    event_assign（event，base，signum，EV_SIGNAL | EV_PERSIST，callback，arg）</div></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果你需要使用event_assign（），</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">并</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">保持与未来版本的</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">Libevent的</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">二进制兼容性，你可以要求Libevent库在运行时告诉你</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">struct事件</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">应该有</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">多大</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>size_t event_get_struct_event_size(void);</div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">该函数返回了需要设置的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体的字节数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在此之前</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果你认识到为你的程序在堆上内存分配实际上是一个很重要的问题</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">你可能仅仅会使用这个函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">因为这会使你的程序更加难以读写</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">注意</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_get_struct_event_size()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在将来版本可能会给出比当前</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">sizeof(struct event)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">更大的值</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果是这样</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">那么这就意味着</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">字节末尾的额外字节是预留的填充字节</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">以便未来的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">LibEvent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">版本使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这里也有一个和上面类似的例子</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不同的是它不依赖于</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">sizeof</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">来计算</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">struct.h</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">中的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体的字节大小</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而是使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_get_struct_event_size()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">来运行时计算正确的值</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/event.h&gt;</div><div>#include &lt;stdlib.h&gt;</div><div><font color="#A8A8A8">/* When we allocate an event_pair in memory, we’ll actually allocate</font></div><div><font color="#A8A8A8">more space at the end of the structure. We define some macros</font></div><div><font color="#A8A8A8">to make accessing those events less error-prone.*/</font></div><div>struct event_pair</div><div>{</div><div>    evutil_socket_t fd;</div><div>};</div><div><font style="color: rgb(168, 168, 168);">/* Macro: yield the struct event ’offset’ bytes from the start of ’p’*/</font></div><div>#define EVENT_AT_OFFSET(p, offset) \</div><div>((struct event * ) ( ((char * )(p)) + (offset) ))</div><div><font style="color: rgb(168, 168, 168);">/* Macro: yield the read event of an event_pair*/</font></div><div>#define READEV_PTR(pair) \</div><div>    EVENT_AT_OFFSET((pair), sizeof(struct event_pair))</div><div><font color="#A8A8A8">/* Macro: yield the write event of an event_pair*/</font></div><div>#define WRITEEV_PTR(pair) \</div><div>    EVENT_AT_OFFSET((pair), \</div><div>    sizeof(struct event_pair)+event_get_struct_event_size())</div><div><font color="#A8A8A8">/* Macro: yield the actual size to allocate for an event_pair*/</font></div><div>#define EVENT_PAIR_SIZE() \</div><div>    (sizeof(struct event_pair)+2 * event_get_struct_event_size())</div><div>void readcb(evutil_socket_t, short, void* );</div><div>void writecb(evutil_socket_t, short, void* );</div><div>struct event_pair* event_pair_new(struct event_base * base, evutil_socket_t fd)</div><div>{</div><div>    struct event_pair* p = malloc(EVENT_PAIR_SIZE());</div><div>    if (!p) return NULL;</div><div>    p-&gt;fd = fd;</div><div>    event_assign(READEV_PTR(p), base, fd, EV_READ|EV_PERSIST, readcb, p);</div><div>    event_assign(WRITEEV_PTR(p), base, fd, EV_WRITE|EV_PERSIST, writecb, p);</div><div>    return p;</div><div>}</div></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">使事件未决和非未决</span></font></span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">一旦你构造了一个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">它是不会做任何事的直到你</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">add</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">它使之未决</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_add</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这样做</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span></font></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10.5pt;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_add(struct event* ev, const struct timeval * tv);</div></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在非未决的事件上调用 event_add()将使其在配置的 event_base 中成为未决的.成功时函数返回0,失败时返回-1.如果 tv 为 NULL,添加的事件不会超时.否则,tv以秒和微秒指定超时值.</span></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果对已经未决的事件调用 event_add() ,事件将保持未决状态,并在指定的超时时间被重新调度.</span></div><div><br/></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">置</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">tv</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">为 希 望 超 时 事 件 执 行 的 时 间</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如 果 在</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">2010</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">年</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">1</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">月</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">1</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">日 设 置</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">&quot;</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">tv-&gt;tv_sec=time(NULL)+10;</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">&quot;</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">超时事件将会等待</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">40</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">年</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而不是</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">10</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">秒</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_del(struct event* ev);</div></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">对已经初始化的事件调用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_del</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">将使其成为非未决和非激活的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果事件不是未决的或者激活的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">调用将没有效果</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">成功时函数返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">失败时返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">-1</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果在事件激活后</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">其回调被执行前删除事件</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">回调将不会执行</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_remove_timer(struct event* ev);</div></div><div><br/></div><div><br/></div><div><span style="font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">最后你可以移除一个event的超时而不再需要删除IO或信号组件了.如果event没有超时未决,event_remove_timer()函数调用不会产生影响.如果event只有超时但是没有信号组件,event_remove_timer()与event_del()有相同的作用.函数成功返回0,失败返回-1.</span></div><div><br/></div><div><span style="font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">事件优先级</span></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">当多个</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">同时触发</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,LibEvent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">并没有定义回掉函数执行要遵循的任何顺序</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以用优先级来定义一些</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">比其他</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">更加重要</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在之前部分的讨论中我们知道</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">有一个或多个优先级关联到它</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在添加</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">到</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">之前在初始化它之后</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">你可以设置它的优先级</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_priority_set(struct event* event, int priority);</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的优先级是一个在</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">和优先级总数之间的一个值</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,减去1</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数成功返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">失败返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">-1.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">但多个事件的多个优先级开始活动</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">低优先级的不会被执行</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而回执行高优先级的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">然后再检查</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的优先级</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">再来一次</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">直到高优先级的事件都没有活动则才开始运行低优先级的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event.</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/event.h&gt;</div><div>void read_cb(evutil_socket_t, short, void* );</div><div>void write_cb(evutil_socket_t, short, void* );</div><div>void main_loop(evutil_socket_t fd)</div><div>{</div><div>    struct event* important, * unimportant;</div><div>    struct event_base* base;</div><div>    base = event_base_new();</div><div>    event_base_priority_init(base, 2);</div><div>    /* Now base has priority 0, and priority 1*/</div><div>    important = event_new(base, fd, EV_WRITE|EV_PERSIST, write_cb, NULL);</div><div>    unimportant = event_new(base, fd, EV_READ|EV_PERSIST, read_cb, NULL);</div><div>    event_priority_set(important, 0);</div><div>    event_priority_set(unimportant, 1);</div><div>    /* Now, whenever the fd is ready for writing, the write callback will</div><div>    happen before the read callback. The read callback won’t happen at</div><div>    all until the write callback is no longer active.*/</div><div>}</div></div><div><br/></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: medium; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果未设置事件的优先级，则默认值为事件库中的队列数除以2。</span></span></div><div><br/></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">检查事件的状态</span></span></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">有时候你想要判断一个</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">是否被添加</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">判断它引用的是什么内容</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_pending(const struct event* ev, short what, struct timeval * tv_out);</div><div><br/></div><div>#define event_get_signal(ev) /* ...*/</div><div>evutil_socket_t event_get_fd(const struct event* ev);</div><div><br/></div><div>struct event_base* event_get_base(const struct event * ev);</div><div><br/></div><div>short event_get_events(const struct event* ev);</div><div><br/></div><div>event_callback_fn event_get_callback(const struct event* ev);</div><div><br/></div><div>void* event_get_callback_arg(const struct event * ev);</div><div><br/></div><div>int event_get_priority(const struct event* ev);</div><div><br/></div><div>void event_get_assignment(    const struct event* event,</div><div>                struct event_base** base_out,</div><div>                evutil_socket_t* fd_out,</div><div>                short* events_out,</div><div>                event_callback_fn* callback_out,</div><div>                void** arg_out);</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_pending</span>函数确定给定事件是挂起还是活动。</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果是，并且在</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">what</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">参数</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">中设置了任何标志EV_READ，EV_WRITE，EV_SIGNAL和EV_TIMEOUT</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">，则该函数返回事件当前挂起或处于活动状态的所有标志。</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">提供了</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">tv_out</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">，并且EV_TIMEOUT设置what</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">，并且事件当前在超时时挂起或处于活动状态，则</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">tv_out</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">设置为保持事件超时到期的时间。</span></font></div><div><br/></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_get_fd()</span><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数和event_get_signal()函数返回了event配置的文件描述符或者型号数量.</span></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_get_base()</span><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">返回event配置的event_base.</span></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_get_events()</span><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数返回事件的标志(EV_READ、EV_WRITE等).</span></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_get_callback()</span><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">和event_get_callback_arg()函数返回了event的回掉函数和它的参数指针.</span></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_get_priority()</span><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数返回了事件当前分配的优先级.</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_get_assignment()</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数拷贝</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">分配的所有字段到提供的指针</span><span style="outline: 0px; overflow-wrap: break-word; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果指针为空</span><span style="outline: 0px; overflow-wrap: break-word; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">则忽略</span><span style="outline: 0px; overflow-wrap: break-word; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="outline: 0px; overflow-wrap: break-word;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">示例：</span></span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 10pt;">#include &lt;event2/event.h&gt;</font></div><div><font style="font-size: 10pt;">#include &lt;stdio.h&gt;</font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">/* Change the callback and callback_arg of ‘ev’, which must not be pending.*/</font></font></div><div><font style="font-size: 10pt;">int replace_callback(struct event* ev,</font></div><div><font style="font-size: 10pt;">            event_callback_fn new_callback,</font></div><div><font style="font-size: 10pt;">            void*new_callback_arg)</font></div><div><font style="font-size: 10pt;">{</font></div><div><font style="font-size: 10pt;">    struct event_base* base;</font></div><div><font style="font-size: 10pt;">    evutil_socket_t fd;</font></div><div><font style="font-size: 10pt;">    short events;</font></div><div><font style="font-size: 10pt;">    int pending;</font></div><div><font style="font-size: 10pt;">    pending = event_pending(ev, EV_READ|EV_WRITE|EV_SIGNAL|EV_TIMEOUT,NULL);</font></div><div><font style="font-size: 10pt;">    if (pending)</font></div><div><font style="font-size: 10pt;">    {</font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">        /* We want to catch this here so that we do not re-assign a</font></font></div><div><font style="font-size: 10pt;"><font color="#A8A8A8">        pending event. That would be very very bad.*/</font></font></div><div><font style="font-size: 10pt;">        fprintf(stderr,&quot;Error! replace_callback called on a pending</font></div><div><font style="font-size: 10pt;">            event!\n&quot;);</font></div><div><font style="font-size: 10pt;">        return -1;</font></div><div><font style="font-size: 10pt;">    }</font></div><div><font style="font-size: 10pt;">    event_get_assignment(ev,</font></div><div><font style="font-size: 10pt;">                &amp;base,</font></div><div><font style="font-size: 10pt;">                &amp;fd,</font></div><div><font style="font-size: 10pt;">                &amp;events,</font></div><div><font style="font-size: 10pt;">                NULL /* ignore old callback*/ ,</font></div><div><font style="font-size: 10pt;">                NULL /* ignore old callback argument*/);</font></div><div><font style="font-size: 10pt;">    event_assign(ev, base, fd, events, new_callback, new_callback_arg);</font></div><div><font style="font-size: 10pt;">    return 0;</font></div><div><font style="font-size: 10pt;">}</font></div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">查找当前正在运行的事件</span></span></font></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">出于调试或其他目的，您可以获取指向当前正在运行的事件的指针。</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>struct event* event_base_get_running_event(struct event_base * base);</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">注意这个函数的行为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">仅仅在提供的</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的循环内部调用的时候被定义</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">在别的线程调用它是不支持的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可能会引起未定义的行为发生</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">配置一次性事件</span></span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果不想重复添加</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或者添加后立马删除</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">它不需要是持久的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">你可以使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base_once()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>int event_base_once(    struct event_base* ,</div><div>            evutil_socket_t, short,</div><div>            void ( * )(evutil_socket_t, short, void* ),</div><div>            void * ,</div><div>            const struct timeval * );</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">该函数接口与</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">相同</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">除了不支持</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">EV_SIGNAL</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">SIG_PERSIST</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">标志</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">队列</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">以默认优先级被插入和运行</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">当回调函数最终完成</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,LibEvent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">释放它自己内部的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">结构体</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">成功返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">失败返回</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">-1.</span></font></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">以</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_base_once</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">插入的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">不能删除或手动激活</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">如果你要使能或取消一个</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">用常用的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event_assign()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">接口来创建</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">注意在LibEvent2.0之前,如果event从来不被触发,用来保存它的内存将永远不会释放.从LibEvent2.1.2-alpha版本开始,当event_base释放的时候释放event,即便它们没有激活,但是还是要意识到:如果有内存关联到它们的回掉函数参数,除非你的程序做点事情去追踪它或者释放它否则你的内存是不会释放掉的.</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">手动激活事件</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可能会有很少的这种情况发生</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">即便</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">的条件没有触发也想要</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">event</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">激活</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>void event_active(struct event* ev, int what, short ncalls);</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">此功能使事件ev</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">以what标志</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">（EV_READ，EV_WRITE和EV_TIMEOUT的组合）活跃。</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">该事件不需要先前处于待处理状态，并且激活它不会使其处于待处理状态。</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">糟糕的示例</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_active()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">无限循环</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>struct event* ev;</div><div>static void cb(int sock, short which, void* arg)</div><div>{</div><div>   <font color="#A8A8A8"> /* Whoops: Calling event_active on the same event unconditionally</font></div><div><font color="#A8A8A8">    from within its callback means that no other events might not getrun!*/</font></div><div>  <font color="#FF0000">  event_active(ev, EV_WRITE, 0);</font></div><div>}</div><div>int main(int argc, char** argv)</div><div>{</div><div>    struct event_base</div><div>    * base = event_base_new();</div><div>    ev = event_new(base, -1, EV_PERSIST | EV_READ, cb, NULL);</div><div>   <font color="#FF0000"> event_add(ev, NULL);</font></div><div><font color="#FF0000">    event_active(ev, EV_WRITE, 0);</font></div><div><font color="#FF0000">    event_base_loop(base, 0);</font></div><div>    return 0;</div><div>}</div></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这将创建一个只执行一次的事件循环</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">然后永远调用函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">&quot;cb&quot;.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">示例</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">上述问题的计时器替代方案</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>struct event* ev;</div><div>struct timeval tv;</div><div>static void cb(int sock, short which, void* arg)</div><div>{</div><div>    if (!evtimer_pending(ev, NULL))</div><div>    {</div><div>        event_del(ev);</div><div>        evtimer_add(ev, &amp;tv);</div><div>    }</div><div>}</div><div>int main(int argc, char** argv)</div><div>{</div><div>    struct event_base</div><div>    * base = event_base_new();</div><div>    tv.tv_sec = 0;</div><div>    tv.tv_usec = 0;</div><div>    ev = evtimer_new(base, cb, NULL);</div><div>    evtimer_add(ev, &amp;tv);</div><div>    event_base_loop(base, 0);</div><div>    return 0;</div><div>}</div></div><div><br/></div><div><font style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">示例</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">:</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">上述问题的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">event_config_set_max_dispatch_interval</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">替代方案</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>struct event* ev;</div><div>static void cb(int sock, short which, void* arg)</div><div>{</div><div>    event_active(ev, EV_WRITE, 0);</div><div>}</div><div>int main(int argc, char** argv)</div><div>{</div><div>    struct event_config* cfg = event_config_new();</div><div>    <font color="#A8A8A8">/* Run at most 16 callbacks before checking for other events.*/</font></div><div>    event_config_set_max_dispatch_interval(cfg, NULL, 16, 0);</div><div>    struct event_base</div><div>    * base = event_base_new_with_config(cfg);</div><div>    ev = event_new(base, -1, EV_PERSIST | EV_READ, cb, NULL);</div><div>    event_add(ev, NULL);</div><div>    event_active(ev, EV_WRITE, 0);</div><div>    event_base_loop(base, 0);</div><div>    return 0;</div><div>}</div></div><div><br/></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">我看了上面这两个例子半天，分明就是第一个的翻版嘛。。。</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">优化通用超时</span></font></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">当前版本的 libevent使用二进制堆算法跟踪未决事件的超时值,这让添加和删除事件超时值具有O(logN)性能.对于随机分布的超时值集合,这是优化的,但对于大量具有相同超时值的事件集合,则不是.</span></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">比如说,假定有10000个事件,每个都需要在添加后5秒触发超时事件.这种情况下,使用双链队列实现才可以取得O(1)性能.</span></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">实际上,不希望为所有超时值使用队列,因为队列仅对常量超时值更快.如果超时值或多或少地随机分布,则向队列添加超时值的性能将是O(n) ,这显然比使用二进制堆糟糕得多.</span></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">libevent通过放置一些超时值到队列中,另一些到二进制堆中来解决这个问题.要使用这个机制,需要向libevent请求一个&quot;公用超时(common timeout)&quot;值,然后使用它来添加事件.如果有大量具有单个公用超时值的事件,使用这个优化应该可以改进超时处理性能.</span></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>const struct timeval* event_base_init_common_timeout(</div><div>                struct event_base* base,</div><div>                const struct timeval * duration);</div></div><div><br/></div><div><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">这个函数需要 event_base和要初始化的公用超时值作为参数.函数返回一个到特别的timeval结构体的指针,可以使用这个指针指示事件应该被添加到O(1)队列,而不是O(logN)堆.可以在代码中自由地复制这个特别的timeval或者进行赋值,但它仅对用于构造它的特定event_base有效.不能依赖于其实际内容:libevent使用这个内容来告知自身使用哪个队列.</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/event.h&gt;</div><div>#include &lt;string.h&gt;</div><div><font color="#A8A8A8">/* We’re going to create a very large number of events on a given base,</font></div><div><font color="#A8A8A8">nearly all of which have a ten-second timeout. If initialize_timeout</font></div><div><font color="#A8A8A8">is called, we’ll tell Libevent to add the ten-second ones to an O(1) queue.*/</font></div><div>struct timeval ten_seconds = { 10, 0 };</div><div>void initialize_timeout(struct event_base* base)</div><div>{</div><div>    struct timeval tv_in = { 10, 0 };</div><div>    const struct timeval</div><div>    * tv_out;</div><div>    tv_out = event_base_init_common_timeout(base, &amp;tv_in);</div><div>    memcpy(&amp;ten_seconds, tv_out, sizeof(struct timeval));</div><div>}</div><div>int my_event_add(struct event* ev, const struct timeval * tv)</div><div>{</div><div>   <font color="#A8A8A8"> /* Note that ev must have the same event_base that we passed to</font></div><div><font color="#A8A8A8">    initialize_timeout</font></div><div><font color="#A8A8A8">    */</font></div><div>    if (tv &amp;&amp; tv-&gt;tv_sec == 10 &amp;&amp; tv-&gt;tv_usec == 0)</div><div>        return event_add(ev, &amp;ten_seconds);</div><div>    else</div><div>        return event_add(ev, tv);</div><div>}</div></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">与所有优化函数一样</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">除非确信适合使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">应该避免使用公用超时功能</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">从已清除的内存中识别事件</span></font></div><div><font face="宋体" style="font-size: 10pt;"><br/></font></div><div><font face="宋体" style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">libevent</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">提供了函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">可以从已经通过设置为</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">0(</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">比如说</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">通过</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">calloc()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">分配的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或者使用</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">memset()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">或者</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">bzero()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">清除了的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">)</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">而清除的内存识别出已初始化的事件</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="宋体" style="font-size: 10pt;">int event_initialized(const struct event* ev);</font></div><div><font face="宋体" style="font-size: 10pt;">#define evsignal_initialized(ev) event_initialized(ev)</font></div><div><font face="宋体" style="font-size: 10pt;">#define evtimer_initialized(ev) event_initialized(ev)</font></div></div><div><br/></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">警告这个函数不能可靠地从没有初始化的内存块中识别出已经初始化的事件</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">除非知道被查询的内存要么是已清除的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">要么是已经初始化为事件的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">才能使用这个函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div><font face="宋体" style="font-size: 10pt;"><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">除非编写一个非常特别的应用</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">,</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">通常不需要使用这个函数</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.event_new()</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">返回的事件总是已经初始化的</span><span style="box-sizing: border-box; outline: 0px; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; font-family: 宋体; font-variant-caps: normal; font-variant-ligatures: normal;">.</span></font></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>#include &lt;event2/event.h&gt;</div><div>#include &lt;stdlib.h&gt;</div><div><br/></div><div><br/></div><div>struct reader</div><div>{</div><div>    evutil_socket_t fd;</div><div>};</div><div><br/></div><div><br/></div><div>#define READER_ACTUAL_SIZE() \</div><div>    (sizeof(struct reader) + \</div><div>    event_get_struct_event_size())</div><div><br/></div><div><br/></div><div>#define READER_EVENT_PTR(r) \</div><div>    ((struct event* ) (((char * )(r))+sizeof(struct reader)))</div><div><br/></div><div><br/></div><div>struct reader* allocate_reader(evutil_socket_t fd)</div><div>{</div><div>struct reader* r = calloc(1, READER_ACTUAL_SIZE());</div><div>if (r)</div><div>    r-&gt;fd = fd;</div><div>return r;</div><div>}</div><div>void readcb(evutil_socket_t, short, void* );</div><div>int add_reader(struct reader* r, struct event_base * b)</div><div>{</div><div>struct event* ev = READER_EVENT_PTR(r);</div><div>if (!event_initialized(ev))</div><div>    event_assign(ev, b, r-&gt;fd, EV_READ, readcb, r);</div><div>return event_add(ev, NULL);</div><div>}</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></div><div><br/></div></span>
</div></body></html> 