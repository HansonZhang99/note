# 内核地址相关

1.物理地址：
CPU地址总线传来的地址，物理地址可寻址最大空间和CPU的地址总线条数有关。物理地址很大一部分是留给内存条的，也会被映射到其他存储器上（如显存和BIOS），在程序指令中，虚拟地址通过段页映射后可以得到物理地址，这个
物理地址位于CPU地址总线最大可寻址的空间内。
物理地址空间，很大一部分给RAM使用，小部分给总线用，32位的地址线，可寻址的物理地址空间为4GB，但是RAM一般达不到4GB，并且总线上可能会挂载其他外设设备，这个外设设备会使用除RAM外的物理地址空间。
一般将低的物理地址给RAM用，高的物理地址给总线用。
2.总线地址：
外设使用总线地址，CPU使用物理地址
X86平台上，物理地址就是总线地址。

3.虚拟地址：
虚拟地址需要MMU支持，MMU是CPU的一部分，负责将虚拟地址转换为物理地址。

编址方式：
外设都通过读写设备上的寄存器来访问外设，外设寄存器也称为IO端口，而IO端口有两种编址方式：独立编址和统一编址。

1.统一编址：
外设接口中的IO寄存器（即IO端口）与主存单元一样看待，每个端口占用一个存储单元地址，将主存的一部分划出来用作IO地址空间，
如PDP-11将最高的4K主存空间划分出来作为IO设备寄存器地址。端口占用了存储器的地址空间，使存储器的容量减小。

统一编址也称为IO内存方式，外设寄存位于内存空间，（很多外设有自己的内存，缓冲区，外设的寄存器和内存统称为IO空间）

如Samsung的s3c2440，是32位的ARM处理器，它的4GB地址空间被外设，RAM等瓜分：
0x80001000 LED 8*8点阵地址
0x48000000-0x60000000 SFR（特殊暂存器地址空间）
0x38001002键盘地址
0x30000000-0x34000000 SDRAM空间
0x20000020-0x2000002e IDE
...

独立编址：
IO地址和存储地址分开独立编址，IO端口地址不占用存储空间的地址范围，这样，在系统中就存在了另一种与存储地址无关的IO地址，CPU也必须用专用的输入输出IO指令（IN,OUT）和控制逻辑。
独立编址时，地址总线过来的地址不知道是给内存的还是IO的，处理器会通过MEMR/MEMW和IOR/IOW两值控制信号来实现对IO端口和存储器的不同寻址。
如intel的80x86就是独立编址的，COU内存和IO独立编址，内存和IO地址空间会出现一部分重叠。
独立编址也称为IO端口方式，外设寄存器位于IO地址空间。

对于某一既定的系统，它要么是独立编址、要么是统一编址，具体采用哪一种则取决于CPU的体系结构。 
如，PowerPC、m68k等采用统一编址，而X86等则采用独立编址，存在IO空间的概念。
目前，大多数嵌入式微控制器如ARM、PowerPC等并 不提供I/O空间，仅有内存空间，可直接用地址、指针访问。
但对于Linux内核而言，它可能用于不同的CPU，所以它必须都要考虑这两种方式，于是它采 用一种新的方法，将基于I/O映射方式的或内存映射方式的I/O端口通称为“I/O区域”（I/O region），
不论你采用哪种方式，都要先申请IO区域：request_resource()，结束时释放 它：release_resource()。